{"version":3,"file":"store.js","sources":["../../node_modules/redux-persist/es/stateReconciler/autoMergeLevel2.js","../../node_modules/@wq/store/src/store.js"],"sourcesContent":["function _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n/*\n  autoMergeLevel2: \n    - merges 2 level of substate\n    - skips substate if already modified\n    - this is essentially redux-perist v4 behavior\n*/\nexport default function autoMergeLevel2(inboundState, originalState, reducedState, _ref) {\n  var debug = _ref.debug;\n\n  var newState = _objectSpread({}, reducedState); // only rehydrate if inboundState exists and is an object\n\n\n  if (inboundState && _typeof(inboundState) === 'object') {\n    Object.keys(inboundState).forEach(function (key) {\n      // ignore _persist data\n      if (key === '_persist') return; // if reducer modifies substate, skip auto rehydration\n\n      if (originalState[key] !== reducedState[key]) {\n        if (process.env.NODE_ENV !== 'production' && debug) console.log('redux-persist/stateReconciler: sub state for key `%s` modified, skipping.', key);\n        return;\n      }\n\n      if (isPlainEnoughObject(reducedState[key])) {\n        // if object is plain enough shallow merge the new values (hence \"Level2\")\n        newState[key] = _objectSpread({}, newState[key], {}, inboundState[key]);\n        return;\n      } // otherwise hard set\n\n\n      newState[key] = inboundState[key];\n    });\n  }\n\n  if (process.env.NODE_ENV !== 'production' && debug && inboundState && _typeof(inboundState) === 'object') console.log(\"redux-persist/stateReconciler: rehydrated keys '\".concat(Object.keys(inboundState).join(', '), \"'\"));\n  return newState;\n}\n\nfunction isPlainEnoughObject(o) {\n  return o !== null && !Array.isArray(o) && _typeof(o) === 'object';\n}","import {\n    createStore,\n    combineReducers,\n    applyMiddleware,\n    compose,\n    bindActionCreators\n} from 'redux';\nimport logger from 'redux-logger';\nimport { persistStore, persistReducer, createTransform } from 'redux-persist';\nimport autoMergeLevel2 from 'redux-persist/lib/stateReconciler/autoMergeLevel2';\n\nimport localForage from 'localforage';\nimport 'whatwg-fetch';\n\nconst REMOVE = '@@KVP_REMOVE';\nconst SET = '@@KVP_SET';\nconst CLEAR = '@@KVP_CLEAR';\n\n// Internal variables and functions\nvar _verbosity = {\n    Network: 1,\n    Lookup: 2,\n    Values: 3\n};\n\nclass Store {\n    name;\n    debug = false;\n    // Base URL of web service\n    service;\n    // Default parameters (e.g f=json)\n    defaults = {};\n\n    ready = {\n        then: function() {\n            throw new Error('Call init first!');\n        }\n    };\n\n    // Registered redux functions\n    #reducers = {};\n    #enhanceReducers = [];\n    #persistKeys = [];\n    #transforms = [];\n    #middleware = [];\n    #enhancers = [];\n    #subscribers = [];\n    #deferActions = [];\n    #thunkHandler = null;\n\n    #_promises = {}; // Save promises to prevent redundant fetches\n\n    constructor(name) {\n        if (_stores[name]) {\n            throw name + ' store already exists!';\n        }\n        this.name = name;\n        _stores[name] = this;\n        this.addReducer(\n            'kvp',\n            (state, action) => this.kvpReducer(state, action),\n            true\n        );\n    }\n\n    init(opts = {}) {\n        var self = this;\n        var optlist = [\n            'debug',\n            'storageFail',\n\n            'service',\n            'defaults',\n            'fetchFail',\n            'ajax',\n            'formatKeyword'\n        ];\n        optlist.forEach(function(opt) {\n            if (opts.hasOwnProperty(opt)) {\n                self[opt] = opts[opt];\n            }\n        });\n        if (self.debug) {\n            for (var level in _verbosity) {\n                if (self.debug >= _verbosity[level]) {\n                    self['debug' + level] = true;\n                }\n            }\n            self.addMiddleware(logger);\n        }\n\n        var storeReady;\n        self.ready = new Promise(resolve => (storeReady = resolve));\n\n        var reducer = combineReducers(this.#reducers);\n        this.#enhanceReducers.forEach(enhanceReducer => {\n            reducer = enhanceReducer(reducer);\n        });\n        const enhancers = compose(\n            ...this.#enhancers,\n            applyMiddleware(...this.#middleware)\n        );\n\n        this.lf = localForage.createInstance({ name: this.name });\n\n        const persistConfig = {\n            key: 'root',\n            storage: this.lf,\n            stateReconciler: autoMergeLevel2,\n            serialize: false,\n            transforms: this.#transforms,\n            whitelist: this.#persistKeys,\n            writeFailHandler: error => this.storageFail(error)\n        };\n        const persistedReducer = persistReducer(persistConfig, reducer);\n        this._store = createStore(persistedReducer, {}, enhancers);\n        this._persistor = persistStore(this._store);\n        this._persistor.subscribe(() => {\n            const { bootstrapped } = this._persistor.getState();\n            if (bootstrapped) {\n                storeReady();\n            }\n        });\n        this.#subscribers.forEach(fn => this._store.subscribe(fn));\n        this.#deferActions.forEach(this._store.dispatch);\n    }\n\n    dispatch(action) {\n        if (this._store) {\n            return this._store.dispatch(action);\n        } else {\n            this.#deferActions.push(action);\n        }\n    }\n\n    subscribe(fn) {\n        this.#subscribers.push(fn);\n        if (this._store) {\n            this._store.subscribe(fn);\n        }\n    }\n\n    getState() {\n        return this._store.getState();\n    }\n\n    addReducer(name, reducer, persist, deserialize) {\n        this.#reducers[name] = reducer;\n        if (persist) {\n            this.persistKey(name, persist, deserialize);\n        }\n    }\n\n    addEnhanceReducer(name, enhanceReducer, persist, deserialize) {\n        this.#enhanceReducers.push(enhanceReducer);\n        if (persist) {\n            this.persistKey(name, persist, deserialize);\n        }\n    }\n\n    persistKey(name, serialize, deserialize) {\n        this.#persistKeys.push(name);\n        if (serialize && deserialize) {\n            this.#transforms.push(\n                createTransform(serialize, deserialize, { whitelist: [name] })\n            );\n        }\n    }\n\n    addMiddleware(middleware) {\n        this.#middleware.push(middleware);\n    }\n\n    addEnhancer(enhancer) {\n        this.#enhancers.push(enhancer);\n    }\n\n    bindActionCreators(actions) {\n        return bindActionCreators(actions, this.dispatch.bind(this));\n    }\n\n    addThunk(name, thunk) {\n        if (!this.#thunkHandler) {\n            throw new Error('@wq/router is required to handle thunks');\n        }\n        this.#thunkHandler(name, thunk);\n    }\n\n    setThunkHandler(handler) {\n        this.#thunkHandler = handler;\n    }\n\n    kvpReducer(state = {}, action) {\n        if (action.type === REMOVE) {\n            state = { ...state };\n            delete state[action.payload.key];\n        } else if (action.type === SET) {\n            state = {\n                ...state,\n                [action.payload.key]: action.payload.value\n            };\n        } else if (action.type === CLEAR) {\n            state = {};\n        }\n        return state;\n    }\n\n    // Get value from datastore\n    async get(query) {\n        await this.ready;\n        var self = this;\n        if (Array.isArray(query)) {\n            var promises = query.map(row => self.get(row));\n            return Promise.all(promises);\n        }\n        query = self.normalizeQuery(query);\n        var key = self.toKey(query);\n\n        if (self.debugLookup) {\n            console.log('looking up ' + key);\n        }\n\n        // Check storage first\n        const kvp = this.getState().kvp;\n        if (kvp[key]) {\n            if (self.debugLookup) {\n                console.log('in storage');\n            }\n            return kvp[key];\n        } else {\n            // Search ends here if query is a simple string\n            if (typeof query == 'string') {\n                if (self.debugLookup) {\n                    console.log('not found');\n                }\n                return null;\n            }\n\n            // More complex queries are assumed to be server requests\n            return self.fetch(query, true);\n        }\n    }\n\n    // Set value\n    async set(query, value) {\n        var self = this;\n        var key = self.toKey(query);\n        if (value === null) {\n            if (self.debugLookup) {\n                console.log('deleting ' + key);\n            }\n            self.dispatch({\n                type: REMOVE,\n                payload: { key }\n            });\n            return;\n        } else {\n            if (self.debugLookup) {\n                console.log('saving new value for ' + key);\n                if (self.debugValues) {\n                    console.log(value);\n                }\n            }\n            self.dispatch({\n                type: SET,\n                payload: { key, value }\n            });\n            return;\n        }\n    }\n\n    // Callback for localStorage failure - override to inform the user\n    storageFail(error) {\n        console.warn('Error persisting store:');\n        console.warn(error);\n    }\n\n    // Convert \"/url\" to {'url': \"url\"} (simplify common use case)\n    normalizeQuery(query) {\n        if (typeof query === 'string' && query.charAt(0) == '/') {\n            query = { url: query.replace(/^\\//, '') };\n        }\n        return query;\n    }\n\n    // Helper to allow simple objects to be used as keys\n    toKey(query) {\n        var self = this;\n        query = self.normalizeQuery(query);\n        if (!query) {\n            throw 'Invalid query!';\n        }\n        if (typeof query == 'string') {\n            return query;\n        } else {\n            return new URLSearchParams(query).toString();\n        }\n    }\n\n    // Helper to check existence of a key without loading the object\n    exists(query) {\n        var self = this;\n        var key = self.toKey(query);\n        return self.keys().then(function(keys) {\n            var found = false;\n            keys.forEach(function(k) {\n                if (k === key) {\n                    found = true;\n                }\n            });\n            return found;\n        });\n    }\n\n    // Fetch data from server\n    fetch(query, cache) {\n        var self = this;\n        query = self.normalizeQuery(query);\n        var key = self.toKey(query);\n        var data = { ...self.defaults, ...query };\n        var url = self.service;\n        if (data.hasOwnProperty('url')) {\n            url = url + '/' + data.url;\n            delete data.url;\n        }\n        if (data.format && !self.formatKeyword) {\n            url += '.' + data.format;\n            delete data.format;\n        }\n\n        if (this.#_promises[key]) {\n            return this.#_promises[key];\n        }\n\n        if (self.debugNetwork) {\n            console.log('fetching ' + key);\n        }\n\n        var promise = self.ajax(url, data, 'GET');\n        this.#_promises[key] = promise.then(\n            async data => {\n                delete this.#_promises[key];\n                if (!data) {\n                    self.fetchFail(query, 'Error parsing data!');\n                    return;\n                }\n                if (self.debugNetwork) {\n                    console.log('received result for ' + key);\n                    if (self.debugValues) {\n                        console.log(data);\n                    }\n                }\n                if (cache) {\n                    await self.set(query, data);\n                }\n                return data;\n            },\n            error => {\n                delete this.#_promises[key];\n                console.error(error);\n                self.fetchFail(query, 'Error parsing data!');\n            }\n        );\n        return this.#_promises[key];\n    }\n\n    // Hook to allow full AJAX customization\n    ajax(url, data, method, headers) {\n        var urlObj = new URL(url, window.location.origin);\n        if (!method) {\n            method = 'GET';\n        } else {\n            method = method.toUpperCase();\n        }\n        if (method == 'GET') {\n            Object.entries(data || {}).forEach(([key, value]) =>\n                urlObj.searchParams.append(key, value)\n            );\n            data = null;\n        }\n        return fetch(urlObj, {\n            method: method,\n            body: data,\n            headers: headers\n        }).then(response => {\n            if (response.ok) {\n                if (response.status === 204) {\n                    return null;\n                } else {\n                    return response.json();\n                }\n            } else {\n                return response.text().then(result => {\n                    var error = new Error();\n                    try {\n                        error.json = JSON.parse(result);\n                    } catch (e) {\n                        error.text = result;\n                    }\n                    error.status = response.status;\n                    throw error;\n                });\n            }\n        });\n    }\n\n    // Callback for fetch() failures - override to inform the user\n    fetchFail(query, error) {\n        var self = this;\n        var key = self.toKey(query);\n        console.warn('Error loading ' + key + ': ' + error);\n    }\n\n    // Helper function for prefetching data\n    prefetch(query) {\n        var self = this;\n        return self.fetch(query, true);\n    }\n\n    // Clear local caches\n    async reset() {\n        this.dispatch({ type: CLEAR });\n        await this._persistor.purge();\n    }\n\n    // List storage keys matching this store's key prefix\n    async keys() {\n        return Object.keys(this.getState().kvp);\n    }\n}\n\nvar _stores = {};\n\n// Hybrid module object provides/is a singleton instance...\nvar ds = new Store('main');\n\n// ... and a way to retrieve/autoinit other stores\nds.getStore = getStore;\nfunction getStore(name) {\n    if (_stores[name]) {\n        return _stores[name];\n    } else {\n        return new Store(name);\n    }\n}\n\nexport default ds;\nexport { getStore, Store };\n"],"names":["_typeof","obj","Symbol","_typeof2","iterator","constructor","prototype","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","value","configurable","writable","autoMergeLevel2","inboundState","originalState","reducedState","_ref","debug","newState","isPlainEnoughObject","o","Array","isArray","REMOVE","SET","CLEAR","_verbosity","Network","Lookup","Values","Store","name","then","Error","_stores","addReducer","state","action","kvpReducer","opts","self","optlist","opt","hasOwnProperty","level","addMiddleware","logger","storeReady","ready","Promise","resolve","reducer","combineReducers","enhanceReducer","enhancers","compose","applyMiddleware","lf","localForage","createInstance","persistConfig","storage","stateReconciler","serialize","transforms","whitelist","writeFailHandler","error","storageFail","persistedReducer","persistReducer","_store","createStore","_persistor","persistStore","subscribe","getState","bootstrapped","fn","dispatch","persist","deserialize","persistKey","createTransform","middleware","enhancer","actions","bindActionCreators","bind","thunk","handler","type","payload","query","promises","map","row","get","all","normalizeQuery","toKey","debugLookup","console","log","kvp","fetch","debugValues","warn","charAt","url","replace","URLSearchParams","toString","found","k","cache","data","defaults","service","format","formatKeyword","debugNetwork","promise","ajax","fetchFail","set","method","headers","urlObj","URL","window","location","origin","toUpperCase","entries","searchParams","append","body","response","ok","status","json","text","result","JSON","parse","e","purge","ds","getStore"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,SAASA,SAAT,CAAiBC,GAAjB,EAAsB;QAAM,OAAOC,MAAP,KAAkB,UAAlB,IAAgCC,QAAOD,MAAM,CAACE,QAAd,MAA2B,QAA/D,EAAyE;QAAEJ,SAAO,GAAG,SAASA,SAAT,CAAiBC,GAAjB,EAAsB;2BAAgBA,GAAd;SAAlC;KAA3E,MAA0I;QAAED,SAAO,GAAG,SAASA,SAAT,CAAiBC,GAAjB,EAAsB;mBAASA,GAAG,IAAI,OAAOC,MAAP,KAAkB,UAAzB,IAAuCD,GAAG,CAACI,WAAJ,KAAoBH,MAA3D,IAAqED,GAAG,KAAKC,MAAM,CAACI,SAApF,GAAgG,QAAhG,WAAkHL,GAAlH,CAAP;SAAlC;;;WAA4KD,SAAO,CAACC,GAAD,CAAd;;;AAEzU,SAASM,SAAT,CAAiBC,MAAjB,EAAyBC,cAAzB,EAAyC;QAAMC,IAAI,GAAGC,MAAM,CAACD,IAAP,CAAYF,MAAZ,CAAX;;QAAoCG,MAAM,CAACC,qBAAX,EAAkC;YAAMC,OAAO,GAAGF,MAAM,CAACC,qBAAP,CAA6BJ,MAA7B,CAAd;YAAwDC,cAAJ,EAAoBI,OAAO,GAAGA,OAAO,CAACC,MAAR,CAAe,UAAUC,GAAV,EAAe;mBAASJ,MAAM,CAACK,wBAAP,CAAgCR,MAAhC,EAAwCO,GAAxC,EAA6CE,UAApD;SAAhC,CAAV;QAA8GP,IAAI,CAACQ,IAAL,CAAUC,KAAV,CAAgBT,IAAhB,EAAsBG,OAAtB;;;WAAyCH,IAAP;;;AAEvU,SAASU,aAAT,CAAuBC,MAAvB,EAA+B;SAAO,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGC,SAAS,CAACC,MAA9B,EAAsCF,CAAC,EAAvC,EAA2C;YAAMG,MAAM,GAAGF,SAAS,CAACD,CAAD,CAAT,IAAgB,IAAhB,GAAuBC,SAAS,CAACD,CAAD,CAAhC,GAAsC,EAAnD;;YAA2DA,CAAC,GAAG,CAAR,EAAW;YAAEf,SAAO,CAACkB,MAAD,EAAS,IAAT,CAAP,CAAsBC,OAAtB,CAA8B,UAAUC,GAAV,EAAe;gBAAEC,iBAAe,CAACP,MAAD,EAASM,GAAT,EAAcF,MAAM,CAACE,GAAD,CAApB,CAAf;aAA/C;SAAb,MAAkH,IAAIhB,MAAM,CAACkB,yBAAX,EAAsC;YAAElB,MAAM,CAACmB,gBAAP,CAAwBT,MAAxB,EAAgCV,MAAM,CAACkB,yBAAP,CAAiCJ,MAAjC,CAAhC;SAAxC,MAA0H;YAAElB,SAAO,CAACkB,MAAD,CAAP,CAAgBC,OAAhB,CAAwB,UAAUC,GAAV,EAAe;gBAAEhB,MAAM,CAACoB,cAAP,CAAsBV,MAAtB,EAA8BM,GAA9B,EAAmChB,MAAM,CAACK,wBAAP,CAAgCS,MAAhC,EAAwCE,GAAxC,CAAnC;aAAzC;;;;WAA0IN,MAAP;;;AAEtf,SAASO,iBAAT,CAAyB3B,GAAzB,EAA8B0B,GAA9B,EAAmCK,KAAnC,EAA0C;QAAML,GAAG,IAAI1B,GAAX,EAAgB;QAAEU,MAAM,CAACoB,cAAP,CAAsB9B,GAAtB,EAA2B0B,GAA3B,EAAgC;YAAEK,KAAK,EAAEA,KAAT;YAAgBf,UAAU,EAAE,IAA5B;YAAkCgB,YAAY,EAAE,IAAhD;YAAsDC,QAAQ,EAAE;SAAhG;KAAlB,MAAkI;QAAEjC,GAAG,CAAC0B,GAAD,CAAH,GAAWK,KAAX;;;WAA2B/B,GAAP;;;;;;;;;;AAQpM,AAAe,SAASkC,eAAT,CAAyBC,YAAzB,EAAuCC,aAAvC,EAAsDC,YAAtD,EAAoEC,IAApE,EAA0E;QACnFC,KAAK,GAAGD,IAAI,CAACC,KAAjB;;QAEIC,QAAQ,GAAGrB,aAAa,CAAC,EAAD,EAAKkB,YAAL,CAA5B,CAHuF;;;QAMnFF,YAAY,IAAIpC,SAAO,CAACoC,YAAD,CAAP,KAA0B,QAA9C,EAAwD;QACtDzB,MAAM,CAACD,IAAP,CAAY0B,YAAZ,EAA0BV,OAA1B,CAAkC,UAAUC,GAAV,EAAe;;gBAE3CA,GAAG,KAAK,UAAZ,EAAwB,OAFuB;;gBAI3CU,aAAa,CAACV,GAAD,CAAb,KAAuBW,YAAY,CAACX,GAAD,CAAvC,EAA8C;AAC5C,AACA;;;gBAGEe,mBAAmB,CAACJ,YAAY,CAACX,GAAD,CAAb,CAAvB,EAA4C;;gBAE1Cc,QAAQ,CAACd,GAAD,CAAR,GAAgBP,aAAa,CAAC,EAAD,EAAKqB,QAAQ,CAACd,GAAD,CAAb,EAAoB,EAApB,EAAwBS,YAAY,CAACT,GAAD,CAApC,CAA7B;;aAX6C;;;YAgB/Cc,QAAQ,CAACd,GAAD,CAAR,GAAgBS,YAAY,CAACT,GAAD,CAA5B;SAhBF;;AAqBF,WAAOc,QAAP;;;AAGF,SAASC,mBAAT,CAA6BC,CAA7B,EAAgC;WACvBA,CAAC,KAAK,IAAN,IAAc,CAACC,KAAK,CAACC,OAAN,CAAcF,CAAd,CAAf,IAAmC3C,SAAO,CAAC2C,CAAD,CAAP,KAAe,QAAzD;;;AChCF,IAAMG,MAAM,GAAG,cAAf;AACA,IAAMC,GAAG,GAAG,WAAZ;AACA,IAAMC,KAAK,GAAG,aAAd;;AAGA,IAAIC,UAAU,GAAG;IACbC,OAAO,EAAE,CADI;IAEbC,MAAM,EAAE,CAFK;IAGbC,MAAM,EAAE;CAHZ;;IAMMC;;;;;;;mBA2BUC,IAAZ,EAAkB;;;;;;;uCAzBV,KAyBU;;;;0CArBP,EAqBO;;uCAnBV;YACJC,IAAI,EAAE,gBAAW;sBACP,IAAIC,KAAJ,CAAU,kBAAV,CAAN;;SAiBU;;;;mBAZN;;;;;mBACO;;;;;mBACJ;;;;;mBACD;;;;;mBACA;;;;;mBACD;;;;;mBACE;;;;;mBACC;;;;;mBACA;;;;;mBAEH;;;YAGLC,OAAO,CAACH,IAAD,CAAX,EAAmB;kBACTA,IAAI,GAAG,wBAAb;;;aAECA,IAAL,GAAYA,IAAZ;QACAG,OAAO,CAACH,IAAD,CAAP,GAAgB,IAAhB;aACKI,UAAL,CACI,KADJ,EAEI,UAACC,KAAD,EAAQC,MAAR;mBAAmB,KAAI,CAACC,UAAL,CAAgBF,KAAhB,EAAuBC,MAAvB,CAAnB;SAFJ,EAGI,IAHJ;;;;;+BAOY;;;gBAAXE,IAAW,uEAAJ,EAAI;gBACRC,IAAI,GAAG,IAAX;gBACIC,OAAO,GAAG,CACV,OADU,EAEV,aAFU,EAIV,SAJU,EAKV,UALU,EAMV,WANU,EAOV,MAPU,EAQV,eARU,CAAd;YAUAA,OAAO,CAACtC,OAAR,CAAgB,UAASuC,GAAT,EAAc;oBACtBH,IAAI,CAACI,cAAL,CAAoBD,GAApB,CAAJ,EAA8B;oBAC1BF,IAAI,CAACE,GAAD,CAAJ,GAAYH,IAAI,CAACG,GAAD,CAAhB;;aAFR;;gBAKIF,IAAI,CAACvB,KAAT,EAAgB;qBACP,IAAI2B,KAAT,IAAkBlB,UAAlB,EAA8B;wBACtBc,IAAI,CAACvB,KAAL,IAAcS,UAAU,CAACkB,KAAD,CAA5B,EAAqC;wBACjCJ,IAAI,CAAC,UAAUI,KAAX,CAAJ,GAAwB,IAAxB;;;;gBAGRJ,IAAI,CAACK,aAAL,CAAmBC,MAAnB;;;gBAGAC,UAAJ;YACAP,IAAI,CAACQ,KAAL,GAAa,IAAIC,OAAJ,CAAY,UAAAC,OAAO;uBAAKH,UAAU,GAAGG,OAAlB;aAAnB,CAAb;gBAEIC,OAAO,GAAGC,qBAAe,uBAAC,IAAD,aAA7B;;0DACsBjD,OAAtB,CAA8B,UAAAkD,cAAc,EAAI;gBAC5CF,OAAO,GAAGE,cAAc,CAACF,OAAD,CAAxB;aADJ;;gBAGMG,SAAS,GAAGC,aAAO,MAAP,kDACX,IADW,uBAEdC,qBAAe,MAAf,kDAAmB,IAAnB,gBAFc,GAAlB;iBAKKC,EAAL,GAAUC,WAAW,CAACC,cAAZ,CAA2B;gBAAE5B,IAAI,EAAE,KAAKA;aAAxC,CAAV;gBAEM6B,aAAa,GAAG;gBAClBxD,GAAG,EAAE,MADa;gBAElByD,OAAO,EAAE,KAAKJ,EAFI;gBAGlBK,eAAe,EAAElD,eAHC;gBAIlBmD,SAAS,EAAE,KAJO;gBAKlBC,UAAU,wBAAE,IAAF,cALQ;gBAMlBC,SAAS,wBAAE,IAAF,eANS;gBAOlBC,gBAAgB,EAAE,0BAAAC,KAAK;2BAAI,MAAI,CAACC,WAAL,CAAiBD,KAAjB,CAAJ;;aAP3B;gBASME,gBAAgB,GAAGC,2BAAc,CAACV,aAAD,EAAgBT,OAAhB,CAAvC;iBACKoB,MAAL,GAAcC,iBAAW,CAACH,gBAAD,EAAmB,EAAnB,EAAuBf,SAAvB,CAAzB;iBACKmB,UAAL,GAAkBC,yBAAY,CAAC,KAAKH,MAAN,CAA9B;;iBACKE,UAAL,CAAgBE,SAAhB,CAA0B,YAAM;4CACH,MAAI,CAACF,UAAL,CAAgBG,QAAhB,EADG;oBACpBC,YADoB,yBACpBA,YADoB;;oBAExBA,YAAJ,EAAkB;oBACd9B,UAAU;;aAHlB;;sDAMkB5C,OAAlB,CAA0B,UAAA2E,EAAE;uBAAI,MAAI,CAACP,MAAL,CAAYI,SAAZ,CAAsBG,EAAtB,CAAJ;aAA5B;;uDACmB3E,OAAnB,CAA2B,KAAKoE,MAAL,CAAYQ,QAAvC;;;;iCAGK1C,QAAQ;gBACT,KAAKkC,MAAT,EAAiB;uBACN,KAAKA,MAAL,CAAYQ,QAAZ,CAAqB1C,MAArB,CAAP;aADJ,MAEO;2DACgB1C,IAAnB,CAAwB0C,MAAxB;;;;;kCAIEyC,IAAI;sDACQnF,IAAlB,CAAuBmF,EAAvB;;gBACI,KAAKP,MAAT,EAAiB;qBACRA,MAAL,CAAYI,SAAZ,CAAsBG,EAAtB;;;;;mCAIG;mBACA,KAAKP,MAAL,CAAYK,QAAZ,EAAP;;;;mCAGO7C,MAAMoB,SAAS6B,SAASC,aAAa;mDAC7BlD,IAAf,IAAuBoB,OAAvB;;gBACI6B,OAAJ,EAAa;qBACJE,UAAL,CAAgBnD,IAAhB,EAAsBiD,OAAtB,EAA+BC,WAA/B;;;;;0CAIUlD,MAAMsB,gBAAgB2B,SAASC,aAAa;0DACpCtF,IAAtB,CAA2B0D,cAA3B;;gBACI2B,OAAJ,EAAa;qBACJE,UAAL,CAAgBnD,IAAhB,EAAsBiD,OAAtB,EAA+BC,WAA/B;;;;;mCAIGlD,MAAMgC,WAAWkB,aAAa;sDACnBtF,IAAlB,CAAuBoC,IAAvB;;gBACIgC,SAAS,IAAIkB,WAAjB,EAA8B;yDACTtF,IAAjB,CACIwF,4BAAe,CAACpB,SAAD,EAAYkB,WAAZ,EAAyB;oBAAEhB,SAAS,EAAE,CAAClC,IAAD;iBAAtC,CADnB;;;;;sCAMMqD,YAAY;qDACLzF,IAAjB,CAAsByF,UAAtB;;;;oCAGQC,UAAU;oDACF1F,IAAhB,CAAqB0F,QAArB;;;;2CAGeC,SAAS;mBACjBC,wBAAkB,CAACD,OAAD,EAAU,KAAKP,QAAL,CAAcS,IAAd,CAAmB,IAAnB,CAAV,CAAzB;;;;iCAGKzD,MAAM0D,OAAO;gBACd,uBAAC,IAAD,gBAAJ,EAAyB;sBACf,IAAIxD,KAAJ,CAAU,yCAAV,CAAN;;;kEAEeF,IAAnB,EAAyB0D,KAAzB;;;;wCAGYC,SAAS;uDACAA,OAArB;;;;qCAG2B;gBAApBtD,KAAoB,uEAAZ,EAAY;gBAARC,MAAQ;;gBACvBA,MAAM,CAACsD,IAAP,KAAgBpE,MAApB,EAA4B;gBACxBa,KAAK,sBAAQA,KAAR,CAAL;uBACOA,KAAK,CAACC,MAAM,CAACuD,OAAP,CAAexF,GAAhB,CAAZ;aAFJ,MAGO,IAAIiC,MAAM,CAACsD,IAAP,KAAgBnE,GAApB,EAAyB;gBAC5BY,KAAK,sBACEA,KADF,sBAEAC,MAAM,CAACuD,OAAP,CAAexF,GAFf,EAEqBiC,MAAM,CAACuD,OAAP,CAAenF,KAFpC,EAAL;aADG,MAKA,IAAI4B,MAAM,CAACsD,IAAP,KAAgBlE,KAApB,EAA2B;gBAC9BW,KAAK,GAAG,EAAR;;;mBAEGA,KAAP;;;;;;;;sDAIMyD;;;;;;;uCACA,KAAK7C;;;gCACPR,OAAO;;qCACPnB,KAAK,CAACC,OAAN,CAAcuE,KAAd;;;;;gCACIC,WAAWD,KAAK,CAACE,GAAN,CAAU,UAAAC,GAAG;2CAAIxD,IAAI,CAACyD,GAAL,CAASD,GAAT,CAAJ;iCAAb;iEACR/C,OAAO,CAACiD,GAAR,CAAYJ,QAAZ;;;gCAEXD,KAAK,GAAGrD,IAAI,CAAC2D,cAAL,CAAoBN,KAApB,CAAR;gCACIzF,MAAMoC,IAAI,CAAC4D,KAAL,CAAWP,KAAX;;oCAENrD,IAAI,CAAC6D,WAAT,EAAsB;oCAClBC,OAAO,CAACC,GAAR,CAAY,gBAAgBnG,GAA5B;;;;gCAIEoG,MAAM,KAAK5B,QAAL,GAAgB4B;;qCACxBA,GAAG,CAACpG,GAAD;;;;;oCACCoC,IAAI,CAAC6D,WAAT,EAAsB;oCAClBC,OAAO,CAACC,GAAR,CAAY,YAAZ;;;iEAEGC,GAAG,CAACpG,GAAD;;;sCAGN,OAAOyF,KAAP,IAAgB;;;;;oCACZrD,IAAI,CAAC6D,WAAT,EAAsB;oCAClBC,OAAO,CAACC,GAAR,CAAY,WAAZ;;;iEAEG;;;iEAIJ/D,IAAI,CAACiE,KAAL,CAAWZ,KAAX,EAAkB,IAAlB;;;;;;;;;;;;;;;;;;;;;;uDAKLA,OAAOpF;;;;;;gCACT+B,OAAO;gCACPpC,MAAMoC,IAAI,CAAC4D,KAAL,CAAWP,KAAX;;sCACNpF,KAAK,KAAK;;;;;oCACN+B,IAAI,CAAC6D,WAAT,EAAsB;oCAClBC,OAAO,CAACC,GAAR,CAAY,cAAcnG,GAA1B;;;gCAEJoC,IAAI,CAACuC,QAAL,CAAc;oCACVY,IAAI,EAAEpE,MADI;oCAEVqE,OAAO,EAAE;wCAAExF,GAAG,EAAHA;;iCAFf;;;;oCAMIoC,IAAI,CAAC6D,WAAT,EAAsB;oCAClBC,OAAO,CAACC,GAAR,CAAY,0BAA0BnG,GAAtC;;wCACIoC,IAAI,CAACkE,WAAT,EAAsB;wCAClBJ,OAAO,CAACC,GAAR,CAAY9F,KAAZ;;;;gCAGR+B,IAAI,CAACuC,QAAL,CAAc;oCACVY,IAAI,EAAEnE,GADI;oCAEVoE,OAAO,EAAE;wCAAExF,GAAG,EAAHA,GAAF;wCAAOK,KAAK,EAALA;;iCAFpB;;;;;;;;;;;;;;;;;;;;oCASI0D,OAAO;YACfmC,OAAO,CAACK,IAAR,CAAa,yBAAb;YACAL,OAAO,CAACK,IAAR,CAAaxC,KAAb;;;;;uCAIW0B,OAAO;gBACd,OAAOA,KAAP,KAAiB,QAAjB,IAA6BA,KAAK,CAACe,MAAN,CAAa,CAAb,KAAmB,GAApD,EAAyD;gBACrDf,KAAK,GAAG;oBAAEgB,GAAG,EAAEhB,KAAK,CAACiB,OAAN,CAAc,KAAd,EAAqB,EAArB;iBAAf;;;mBAEGjB,KAAP;;;;;8BAIEA,OAAO;gBACLrD,IAAI,GAAG,IAAX;YACAqD,KAAK,GAAGrD,IAAI,CAAC2D,cAAL,CAAoBN,KAApB,CAAR;;gBACI,CAACA,KAAL,EAAY;sBACF,gBAAN;;;gBAEA,OAAOA,KAAP,IAAgB,QAApB,EAA8B;uBACnBA,KAAP;aADJ,MAEO;uBACI,IAAIkB,eAAJ,CAAoBlB,KAApB,EAA2BmB,QAA3B,EAAP;;;;;;+BAKDnB,OAAO;gBACNrD,IAAI,GAAG,IAAX;gBACIpC,GAAG,GAAGoC,IAAI,CAAC4D,KAAL,CAAWP,KAAX,CAAV;mBACOrD,IAAI,CAACrD,IAAL,GAAY6C,IAAZ,CAAiB,UAAS7C,IAAT,EAAe;oBAC/B8H,KAAK,GAAG,KAAZ;gBACA9H,IAAI,CAACgB,OAAL,CAAa,UAAS+G,CAAT,EAAY;wBACjBA,CAAC,KAAK9G,GAAV,EAAe;wBACX6G,KAAK,GAAG,IAAR;;iBAFR;uBAKOA,KAAP;aAPG,CAAP;;;;;8BAYEpB,OAAOsB,OAAO;;;gBACZ3E,IAAI,GAAG,IAAX;YACAqD,KAAK,GAAGrD,IAAI,CAAC2D,cAAL,CAAoBN,KAApB,CAAR;gBACIzF,GAAG,GAAGoC,IAAI,CAAC4D,KAAL,CAAWP,KAAX,CAAV;;gBACIuB,IAAI,sBAAQ5E,IAAI,CAAC6E,QAAb,MAA0BxB,KAA1B,CAAR;;gBACIgB,GAAG,GAAGrE,IAAI,CAAC8E,OAAf;;gBACIF,IAAI,CAACzE,cAAL,CAAoB,KAApB,CAAJ,EAAgC;gBAC5BkE,GAAG,GAAGA,GAAG,GAAG,GAAN,GAAYO,IAAI,CAACP,GAAvB;uBACOO,IAAI,CAACP,GAAZ;;;gBAEAO,IAAI,CAACG,MAAL,IAAe,CAAC/E,IAAI,CAACgF,aAAzB,EAAwC;gBACpCX,GAAG,IAAI,MAAMO,IAAI,CAACG,MAAlB;uBACOH,IAAI,CAACG,MAAZ;;;gBAGA,uCAAgBnH,GAAhB,CAAJ,EAA0B;uBACf,uCAAgBA,GAAhB,CAAP;;;gBAGAoC,IAAI,CAACiF,YAAT,EAAuB;gBACnBnB,OAAO,CAACC,GAAR,CAAY,cAAcnG,GAA1B;;;gBAGAsH,OAAO,GAAGlF,IAAI,CAACmF,IAAL,CAAUd,GAAV,EAAeO,IAAf,EAAqB,KAArB,CAAd;mDACgBhH,GAAhB,IAAuBsH,OAAO,CAAC1F,IAAR;;;;;yCACnB,kBAAMoF,IAAN;;;;;2CACW,sBAAA,MAAI,YAAJ,CAAgBhH,GAAhB,CAAP;;wCACKgH,IAFT;;;;;oCAGQ5E,IAAI,CAACoF,SAAL,CAAe/B,KAAf,EAAsB,qBAAtB;;;;wCAGArD,IAAI,CAACiF,YAAT,EAAuB;wCACnBnB,OAAO,CAACC,GAAR,CAAY,yBAAyBnG,GAArC;;4CACIoC,IAAI,CAACkE,WAAT,EAAsB;4CAClBJ,OAAO,CAACC,GAAR,CAAYa,IAAZ;;;;yCAGJD,KAZR;;;;;;2CAac3E,IAAI,CAACqF,GAAL,CAAShC,KAAT,EAAgBuB,IAAhB,CAbd;;;sEAeWA,IAfX;;;;;;;;iBADmB;;;;;iBAkBnB,UAAAjD,KAAK,EAAI;uBACE,sBAAA,MAAI,YAAJ,CAAgB/D,GAAhB,CAAP;gBACAkG,OAAO,CAACnC,KAAR,CAAcA,KAAd;gBACA3B,IAAI,CAACoF,SAAL,CAAe/B,KAAf,EAAsB,qBAAtB;aArBe,CAAvB;mBAwBO,uCAAgBzF,GAAhB,CAAP;;;;;6BAICyG,KAAKO,MAAMU,QAAQC,SAAS;gBACzBC,MAAM,GAAG,IAAIC,GAAJ,CAAQpB,GAAR,EAAaqB,MAAM,CAACC,QAAP,CAAgBC,MAA7B,CAAb;;gBACI,CAACN,MAAL,EAAa;gBACTA,MAAM,GAAG,KAAT;aADJ,MAEO;gBACHA,MAAM,GAAGA,MAAM,CAACO,WAAP,EAAT;;;gBAEAP,MAAM,IAAI,KAAd,EAAqB;gBACjB1I,MAAM,CAACkJ,OAAP,CAAelB,IAAI,IAAI,EAAvB,EAA2BjH,OAA3B,CAAmC;;wBAAEC,GAAF;wBAAOK,KAAP;;2BAC/BuH,MAAM,CAACO,YAAP,CAAoBC,MAApB,CAA2BpI,GAA3B,EAAgCK,KAAhC,CAD+B;iBAAnC;gBAGA2G,IAAI,GAAG,IAAP;;;mBAEGX,KAAK,CAACuB,MAAD,EAAS;gBACjBF,MAAM,EAAEA,MADS;gBAEjBW,IAAI,EAAErB,IAFW;gBAGjBW,OAAO,EAAEA;aAHD,CAAL,CAIJ/F,IAJI,CAIC,UAAA0G,QAAQ,EAAI;oBACZA,QAAQ,CAACC,EAAb,EAAiB;wBACTD,QAAQ,CAACE,MAAT,KAAoB,GAAxB,EAA6B;+BAClB,IAAP;qBADJ,MAEO;+BACIF,QAAQ,CAACG,IAAT,EAAP;;iBAJR,MAMO;2BACIH,QAAQ,CAACI,IAAT,GAAgB9G,IAAhB,CAAqB,UAAA+G,MAAM,EAAI;4BAC9B5E,KAAK,GAAG,IAAIlC,KAAJ,EAAZ;;4BACI;4BACAkC,KAAK,CAAC0E,IAAN,GAAaG,IAAI,CAACC,KAAL,CAAWF,MAAX,CAAb;yBADJ,CAEE,OAAOG,CAAP,EAAU;4BACR/E,KAAK,CAAC2E,IAAN,GAAaC,MAAb;;;wBAEJ5E,KAAK,CAACyE,MAAN,GAAeF,QAAQ,CAACE,MAAxB;8BACMzE,KAAN;qBARG,CAAP;;aAZD,CAAP;;;;;kCA2BM0B,OAAO1B,OAAO;gBAChB3B,IAAI,GAAG,IAAX;gBACIpC,GAAG,GAAGoC,IAAI,CAAC4D,KAAL,CAAWP,KAAX,CAAV;YACAS,OAAO,CAACK,IAAR,CAAa,mBAAmBvG,GAAnB,GAAyB,IAAzB,GAAgC+D,KAA7C;;;;;iCAIK0B,OAAO;gBACRrD,IAAI,GAAG,IAAX;mBACOA,IAAI,CAACiE,KAAL,CAAWZ,KAAX,EAAkB,IAAlB,CAAP;;;;;;;;;;;;;qCAKKd,QAAL,CAAc;oCAAEY,IAAI,EAAElE;iCAAtB;;uCACM,KAAKgD,UAAL,CAAgB0E,KAAhB;;;;;;;;;;;;;;;;;;;;;;;;;;;kEAKC/J,MAAM,CAACD,IAAP,CAAY,KAAKyF,QAAL,GAAgB4B,GAA5B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIf,IAAItE,OAAO,GAAG,EAAd;;AAGA,IAAIkH,EAAE,GAAG,IAAItH,KAAJ,CAAU,MAAV,CAAT;;AAGAsH,EAAE,CAACC,QAAH,GAAcA,QAAd;;AACA,SAASA,QAAT,CAAkBtH,IAAlB,EAAwB;QAChBG,OAAO,CAACH,IAAD,CAAX,EAAmB;eACRG,OAAO,CAACH,IAAD,CAAd;KADJ,MAEO;eACI,IAAID,KAAJ,CAAUC,IAAV,CAAP;;;;;;;;;;;;;;;;"}