{"version":3,"file":"template.js","sources":["../../node_modules/@wq/template/src/template.js"],"sourcesContent":["import m from 'mustache';\n\n// Exported module object\nvar tmpl = {};\n\n// Internal variables\nvar _templates = {};\nvar _partials = {};\nvar _defaults = {};\nvar _debug;\nvar $, jqm;\n\ntmpl.init = function(config) {\n    _templates = config.templates || {};\n    _partials = config.partials || config.templates.partials || {};\n    if (config.defaults) {\n        console.warn(\n            new Error(\n                'config.defaults is deprecated; use context plugin instead'\n            )\n        );\n        _defaults = config.defaults;\n    }\n    _debug = config.debug || false;\n    $ = config.jQuery || window.jQuery;\n    jqm = $.mobile;\n};\n\ntmpl.setDefault = function(key, value) {\n    console.warn(\n        new Error('tmpl.setDefault() is deprecated; use context plugin instead')\n    );\n    _defaults[key] = value;\n};\n\ntmpl.render = function(template, data) {\n    if (!$) {\n        throw new Error('Initialize template first!');\n    }\n    var context = {},\n        key;\n    for (key in _defaults) {\n        context[key] = _defaults[key];\n    }\n    for (key in data) {\n        context[key] = data[key];\n    }\n\n    template = _templates[template] || template;\n    return m.render(template, context, _partials);\n};\n\n// Render page and inject it into DOM (replace existing page if it exists)\nfunction inject(template, context, url, pageid) {\n    var html = tmpl.render(template, context);\n    if (!html.match(/<div/)) {\n        throw \"No content found in template '\" + template + \"'!\";\n    }\n    var title = html.split(/<\\/?title>/)[1];\n    var body = html.split(/<\\/?body[^>?]*>/)[1];\n    if (body) {\n        html = body;\n    }\n    var $page = $(html.trim());\n\n    // Check for <div data-role=page>, in case it is not the only element in\n    // the selection (due to an external footer or something)\n    var $rolePage = $page.filter(\":jqmData(role='page')\");\n    if ($rolePage.length > 0) {\n        if (_debug && $rolePage.length != $page.length) {\n            console.info(\n                $page.length - $rolePage.length + ' extra element(s) ignored.'\n            );\n        }\n        $page = $rolePage;\n    } else if ($page.length > 1) {\n        $page = $('<div>').append($page);\n    }\n\n    var role = $page.jqmData('role');\n    var $oldpage;\n    if (pageid) {\n        if (pageid === true) {\n            pageid = template + '-page';\n        }\n        $oldpage = $('#' + pageid);\n    }\n    if (!$oldpage || !$oldpage.length) {\n        $oldpage = $(\":jqmData(url='\" + url + \"')\");\n        if (pageid && $oldpage.attr('id') && $oldpage.attr('id') != pageid) {\n            $oldpage = null;\n        }\n    }\n    if ($oldpage && $oldpage.length) {\n        $oldpage.remove();\n    }\n    if (role == 'popup' || role == 'panel') {\n        $page.appendTo(jqm.activePage[0]);\n        if (role == 'popup') {\n            $page.popup();\n        } else {\n            $page.panel();\n        }\n        $page.trigger('create');\n    } else {\n        $page.attr('data-' + jqm.ns + 'url', url);\n        $page.attr('data-' + jqm.ns + 'title', title);\n        if (pageid) {\n            $page.attr('id', pageid);\n        }\n        $page.appendTo(jqm.pageContainer);\n        $page.page();\n    }\n    return $page;\n}\n\nif (window.MSApp && window.MSApp.execUnsafeLocalFunction) {\n    tmpl.inject = function(template, context, url, pageid) {\n        return window.MSApp.execUnsafeLocalFunction(function() {\n            return inject(template, context, url, pageid);\n        });\n    };\n} else {\n    tmpl.inject = inject;\n}\n\n// Render template only once\ntmpl.injectOnce = function(template, context, url, id) {\n    if (!id) {\n        id = template + '-page';\n    }\n    var $page = $('#' + id);\n    if (!$page.length) {\n        // Initial render, use context if available\n        $page = tmpl.inject(template, context, url, id);\n    } else {\n        // Template was already rendered; ignore context but update URL\n        // - it is up to the caller to update the DOM\n        $page.attr('data-' + jqm.ns + 'url', url);\n        $page.jqmData('url', url);\n    }\n    return $page;\n};\n\n// Render HTML loaded from server\ntmpl.injectHTML = function(html, url, id) {\n    var $page = tmpl.inject('{{{html}}}', { html: html }, url, id);\n    return $page;\n};\n\nexport default tmpl;\n"],"names":["tmpl","_templates","_partials","_defaults","_debug","$","jqm","init","config","templates","partials","defaults","console","warn","Error","debug","jQuery","window","mobile","setDefault","key","value","render","template","data","context","m","inject","url","pageid","html","match","title","split","body","$page","trim","$rolePage","filter","length","info","append","role","jqmData","$oldpage","attr","remove","appendTo","activePage","popup","panel","trigger","ns","pageContainer","page","MSApp","execUnsafeLocalFunction","injectOnce","id","injectHTML"],"mappings":"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"}