{"version":3,"file":"map.js","sources":["../../node_modules/@wq/map/src/draw.js","../../node_modules/@wq/map/src/map.js"],"sourcesContent":["export default function load() {\n    try {\n        return require('leaflet-draw');\n    } catch (e) {\n        return false;\n    }\n}\n","import L from 'leaflet';\nimport tmpl from '@wq/template';\nimport loadDraw from './draw';\n\n// module variable\nvar map = {\n    name: 'map'\n};\n\n// module configuration\nmap.config = {\n    maps: {}, // Auto-populated from app.config.pages where map == true\n    defaults: {\n        bounds: [[-4, -4], [4, 4]],\n        autoZoom: {\n            wait: 0.5, // How long to wait before triggering autoZoom\n            sticky: true, // Start new maps in same location as old maps\n\n            // Settings for fitBounds\n            maxZoom: 13,\n            animate: true\n        },\n\n        // Defaults to simplify creation of new icons of the same dimensions\n        // as L.Icon.Default\n        icon: {\n            iconSize: [25, 41],\n            iconAnchor: [12, 41],\n            popupAnchor: [1, -34],\n            shadowSize: [41, 41]\n        },\n\n        basemaps: _defaultBasemaps()\n    }\n};\n\n// References to generated map objects\nmap.maps = {};\nmap.layers = {};\nmap.basemaps = {};\n\n// References to generated icons\nmap.icons = {\n    default: new L.Icon.Default()\n};\n\n// This will be called by app.init()\nmap.init = function(defaults) {\n    var app = map.app;\n\n    loadDraw();\n\n    // Auto-detect whether CRS-aware GeoJSON parser is available\n    map.geoJson = L.Proj ? L.Proj.geoJson : L.geoJson;\n\n    // Assign after module load in case L.Icon.Default.imagePath is overridden\n    map.config.defaults.icon.shadowUrl = map.icons['default']._getIconUrl(\n        'shadow'\n    );\n\n    if (defaults) {\n        L.extend(map.config.defaults, defaults);\n    }\n\n    // Define map configuration for all app pages with map=True\n    Object.keys(app.config.pages).forEach(function(page) {\n        var pconf = app.config.pages[page],\n            mconf = pconf.map;\n\n        if (!mconf) {\n            return;\n        } else if (mconf === true) {\n            mconf = [];\n        } else if (!Array.isArray(mconf)) {\n            mconf = [mconf];\n        }\n\n        var mapconf = {\n            name: pconf.name,\n            url: pconf.url,\n            defaults: {\n                maps: {\n                    main: {\n                        layers: []\n                    }\n                }\n            }\n        };\n\n        // Initialize map configurations for each page display mode\n        mconf.forEach(function(conf) {\n            var mode = conf.mode || 'defaults',\n                map = conf.map || 'main';\n            if (mode == 'all') {\n                mode = 'defaults';\n            }\n            if (!mapconf[mode]) {\n                mapconf[mode] = {\n                    maps: {}\n                };\n            }\n            mapconf[mode].maps[map] = conf;\n        });\n\n        // Ensure map configurations exist for all list page modes\n        var modes = [];\n        if (pconf.modes) {\n            modes = pconf.modes;\n        } else if (pconf.list) {\n            modes = ['list', 'detail', 'edit'];\n        }\n        modes.forEach(function(mode) {\n            if (mapconf[mode]) {\n                if (\n                    mapconf[mode].maps &&\n                    mapconf[mode].maps.main &&\n                    mapconf[mode].maps.main.autoLayers &&\n                    !mapconf[mode].maps.main.layers\n                ) {\n                    mapconf[mode].maps.main.layers = [];\n                }\n                return;\n            }\n            mapconf[mode] = {\n                maps: {\n                    main: {\n                        autoLayers: true,\n                        layers: []\n                    }\n                }\n            };\n        });\n        map.config.maps[page] = mapconf;\n\n        if (pconf.list) {\n            map.addAutoLayers(page);\n        }\n    });\n};\n\n// Plugin API\nmap.run = function($page, routeInfo) {\n    var mapconf = map.config.maps[routeInfo.page],\n        mode = routeInfo.mode,\n        maps = [];\n    if (!mapconf) {\n        return;\n    }\n    if (mapconf[mode] && mapconf[mode].maps) {\n        maps = Object.keys(mapconf[mode].maps);\n    } else {\n        maps = ['main'];\n    }\n    maps.forEach(function(mapname) {\n        var divid = map.getMapId(routeInfo, mapname) + '-map',\n            $div = $page.find('#' + divid);\n        map.createMap(routeInfo, $div[0], mapname, $page);\n    });\n};\n\n// Add a layer configuration (layerconf) to a map configuration\nmap.addLayerConf = function(page, layerconf, mode, mapname) {\n    if (!mode) {\n        mode = 'defaults';\n    }\n    if (!mapname) {\n        mapname = 'main';\n    }\n    if (!map.config.maps[page]) {\n        throw 'Configuration for \"' + page + '\" not found!';\n    }\n    if (!map.config.maps[page][mode]) {\n        throw 'Configuration for mode \"' + mode + '\" not found!';\n    }\n    if (!layerconf.type) {\n        layerconf.type = 'geojson';\n    }\n    if (!map.createOverlay[layerconf.type]) {\n        throw 'Unknown layer type \"' + layerconf.type + '\"!';\n    }\n    map.config.maps[page][mode].maps[mapname].layers.push(layerconf);\n};\n\n// Define an icon for use by list items displayed as points\nmap.createIcon = function(name, options) {\n    options = L.extend({}, map.config.defaults.icon, options);\n    map.icons[name] = L.icon(options);\n    return map.icons[name];\n};\n\nmap.onEachFeature = function(name, callback) {\n    map.onEachFeature[name] = callback;\n};\n\n// Compute default layer configuration for wq REST API\nmap.addAutoLayers = function(page) {\n    var listConf = _getConf(page, 'list', 'main');\n    if (listConf.autoLayers) {\n        map.addLayerConf(\n            page,\n            {\n                name: listConf.name,\n                type: 'geojson',\n                url: '{{{url}}}.geojson',\n                popup: page,\n                cluster: true\n            },\n            'list'\n        );\n    }\n\n    var detailConf = _getConf(page, 'detail', 'main');\n    if (detailConf.autoLayers) {\n        map.addLayerConf(\n            page,\n            {\n                name: detailConf.name,\n                type: 'geojson',\n                url: detailConf.url + '/{{{id}}}.geojson',\n                popup: page\n            },\n            'detail'\n        );\n    }\n\n    var editConf = _getConf(page, 'edit', 'main');\n    if (editConf.autoLayers) {\n        map.addLayerConf(\n            page,\n            {\n                name: editConf.name,\n                type: 'geojson',\n                url: editConf.url + '/{{{id}}}/edit.geojson',\n                flatten: true,\n                draw: {\n                    polygon: {},\n                    polyline: {},\n                    marker: {},\n                    rectangle: {},\n                    circle: false\n                }\n            },\n            'edit'\n        );\n    }\n};\n\n// Load map configuration for the given page\nmap.getLayerConfs = function(routeInfo, mapname) {\n    var page = routeInfo.page,\n        itemid = routeInfo.item_id,\n        mode = routeInfo.mode,\n        url = routeInfo.path,\n        outboxId = routeInfo.outbox_id;\n    if (!mode) {\n        if (map.app.config.pages[page].list) {\n            mode = itemid ? 'list' : 'detail';\n        }\n    }\n    if (!mapname) {\n        mapname = 'main';\n    }\n    var mapconf = _getConf(page, mode, mapname);\n    var layers = [];\n    if (!url) {\n        url = mapconf.url;\n        if (itemid) {\n            url += '/' + itemid;\n        }\n    }\n    (mapconf.layers || []).forEach(function(layerconf) {\n        var parts = url.split('?'),\n            baseurl = parts[0].replace(/\\/$/, ''),\n            params = (parts[1] && '?' + parts[1]) || '';\n        layerconf = L.extend({}, layerconf);\n        if (layerconf.url && layerconf.url.indexOf('{{') > -1) {\n            layerconf.url = tmpl.render(\n                layerconf.url,\n                L.extend(\n                    {\n                        id: itemid,\n                        url: baseurl\n                    },\n                    routeInfo.item || {}\n                )\n            );\n            if (params && layerconf.url.indexOf('?') > -1) {\n                params = params.replace(/^\\?/, '&');\n            }\n            layerconf.url += params;\n        }\n        if (outboxId && layerconf.draw) {\n            var geomname = layerconf.geometryField || 'geometry';\n            var geom = (routeInfo.context || {})[geomname];\n            if (geom) {\n                layerconf.initData = JSON.parse(geom);\n            } else {\n                layerconf.initData = {\n                    type: 'FeatureCollection',\n                    features: []\n                };\n            }\n        }\n        layers.push(layerconf);\n    });\n    return layers;\n};\n\n// GeoJSON loading function - override to customize\nmap.cache = {};\nmap.loadLayer = function(url) {\n    url = map.app.service + '/' + url;\n    if (map.cache[url]) {\n        return Promise.resolve(map.cache[url]);\n    }\n    // Ignore requests for \"new.geojson\"\n    if (url.match(/\\/(new)?(\\/edit)?\\.geojson$/)) {\n        return Promise.resolve(null);\n    }\n    map.app.spin.start();\n    return map.app.store.ajax(url).then(\n        function(geojson) {\n            map.app.spin.stop();\n            map.cache[url] = geojson;\n            return geojson;\n        },\n        function() {\n            map.app.spin.stop();\n            return null;\n        }\n    );\n};\n\n// Default base map configuration - override to customize\nfunction _defaultBasemaps() {\n    var cdn = '//stamen-tiles-{s}.a.ssl.fastly.net/{layer}/{z}/{x}/{y}.jpg';\n    var attr =\n        'Map tiles by <a href=\"http://stamen.com\">Stamen Design</a>, under <a href=\"http://creativecommons.org/licenses/by/3.0\">CC BY 3.0</a>. Data by <a href=\"http://openstreetmap.org\">OpenStreetMap</a>, under <a href=\"http://www.openstreetmap.org/copyright\">ODbL</a>.';\n    if (!document.location.protocol.match('http')) {\n        cdn = 'https:' + cdn;\n    }\n\n    return [\n        {\n            name: 'Stamen Terrain',\n            type: 'tile',\n            url: cdn,\n            layer: 'terrain',\n            attribution: attr\n        }\n    ];\n}\n\n// Configuration-based basemap creation functions\nmap.createBasemaps = function() {\n    var basemaps = {};\n    map.config.defaults.basemaps.forEach(function(layerconf) {\n        basemaps[layerconf.name] = map.createBasemap(layerconf);\n    });\n    return basemaps;\n};\n\nmap.createBasemap = function(layerconf) {\n    var fn = map.createBasemap[layerconf.type];\n    if (!fn) {\n        throw 'Unknown basemap type \"' + layerconf.type + '\"!';\n    }\n    return fn({ ...layerconf });\n};\n\nmap.addBasemapType = function(type, fn) {\n    map.createBasemap[type] = fn;\n};\n\nmap.addBasemapType('tile', function(layerConf) {\n    return L.tileLayer(layerConf.url, layerConf);\n});\n\n// Configuration-based overlay creation functions\nmap.createOverlay = function(layerconf) {\n    var fn = map.createOverlay[layerconf.type];\n    if (!fn) {\n        throw 'Unknown overlay type \"' + layerconf.type + '\"!';\n    }\n    return fn({ ...layerconf });\n};\n\nmap.addOverlayType = function(type, fn) {\n    map.createOverlay[type] = fn;\n};\n\nmap.addOverlayType('geojson', function(layerconf) {\n    var overlay;\n    if (layerconf.cluster && L.MarkerClusterGroup) {\n        var options = {};\n        if (layerconf.clusterIcon) {\n            options.iconCreateFunction = _makeCluster(layerconf.clusterIcon);\n        }\n        overlay = new L.MarkerClusterGroup(options);\n    } else {\n        overlay = L.featureGroup();\n    }\n\n    var getData;\n    if (layerconf.initData) {\n        getData = Promise.resolve(layerconf.initData);\n    } else {\n        getData = map.loadLayer(layerconf.url);\n    }\n\n    // Load layer content as JSON\n    overlay.ready = getData.then(function(geojson) {\n        var options = {},\n            popup,\n            oneach;\n        if (!geojson || !geojson.type) {\n            console.warn('Ignoring empty or malformed GeoJSON result.');\n            return overlay;\n        }\n        if (layerconf.popup) {\n            popup = map.renderPopup(layerconf.popup);\n        }\n        if (layerconf.oneach) {\n            if (typeof layerconf.oneach == 'function') {\n                oneach = layerconf.oneach;\n            } else {\n                oneach = map.onEachFeature[layerconf.oneach];\n            }\n        }\n        if (oneach && popup) {\n            options.onEachFeature = function(feat, layer) {\n                popup(feat, layer);\n                oneach(feat, layer);\n            };\n        } else if (oneach) {\n            options.onEachFeature = oneach;\n        } else if (popup) {\n            options.onEachFeature = popup;\n        }\n        if (layerconf.icon) {\n            options.pointToLayer = _makeMarker(layerconf.icon);\n        }\n        if (layerconf.style) {\n            options.style = layerconf.style;\n        }\n        if (geojson.type == 'GeometryCollection') {\n            geojson = { type: 'Feature', geometry: geojson };\n        }\n        if (\n            layerconf.draw &&\n            geojson.type == 'Feature' &&\n            geojson.geometry.type == 'GeometryCollection'\n        ) {\n            // Leaflet.draw doesn't support GeometryCollection\n            geojson = {\n                type: 'FeatureCollection',\n                features: geojson.geometry.geometries.map(function(geom) {\n                    return {\n                        type: 'Feature',\n                        geometry: geom\n                    };\n                })\n            };\n        }\n        var gjLayer = map.geoJson(geojson, options);\n        if (layerconf.cluster && L.MarkerClusterGroup) {\n            gjLayer.getLayers().forEach(function(layer) {\n                layer.addTo(overlay);\n            });\n        } else {\n            gjLayer.addTo(overlay);\n        }\n        return gjLayer;\n    });\n\n    return overlay;\n});\n\n// Hooks for customizing layer and draw controls\nmap.createLayerControl = function(basemaps, layers, routeInfo, mapname) {\n    /* eslint no-unused-vars: off */\n    return L.control.layers(basemaps, layers);\n};\n\nmap.addDrawControl = function(m, layer, layerconf, $geom) {\n    var control = new L.Control.Draw({\n        draw: layerconf.draw,\n        edit: { featureGroup: layer }\n    }).addTo(m);\n\n    m.on('draw:created', function(e) {\n        layer.addLayer(e.layer);\n        save();\n    });\n\n    m.on('draw:edited', save);\n    m.on('draw:deleted', save);\n\n    var $submit = $geom.parents('form').find('[type=submit]');\n    m.on('draw:drawstart draw:editstart draw:deletestart', function() {\n        $submit.attr('disabled', true);\n    });\n\n    m.on('draw:drawstop draw:editstop draw:deletestop', function() {\n        $submit.attr('disabled', false);\n    });\n\n    save();\n\n    return control;\n\n    function flatten(geojson) {\n        var geoms = [];\n        if (geojson.type == 'FeatureCollection') {\n            geojson.features.forEach(function(feature) {\n                addGeometry(feature.geometry);\n            });\n        }\n        if (geoms.length == 1) {\n            return geoms[0];\n        } else {\n            return {\n                type: 'GeometryCollection',\n                geometries: geoms\n            };\n        }\n        function addGeometry(geometry) {\n            if (geometry.type == 'GeometryCollection') {\n                geometry.geometries.forEach(addGeometry);\n            } else {\n                geoms.push(geometry);\n            }\n        }\n    }\n\n    function save() {\n        var geojson = layer.toGeoJSON();\n        if (layerconf.flatten) {\n            // Flatten FeatureCollection into single Geometry (or\n            // GeometryCollection).\n            geojson = flatten(geojson);\n        }\n        $geom.val(JSON.stringify(geojson));\n        map.cache = {};\n    }\n};\n\n// Default popup renderer for items - override to customize\n// (assumes template called [page]_popup)\nmap.renderPopup = function(page) {\n    return function(feat, layer) {\n        var attrs = L.extend({ id: feat.id }, feat.properties);\n        layer.bindPopup(tmpl.render(page + '_popup', attrs));\n    };\n};\n\nmap.getMapId = function(routeInfo, mapname) {\n    var rt = routeInfo,\n        parts = [];\n    if (rt.item_id || (rt.mode === 'edit' && rt.variant === 'new')) {\n        if (rt.mode == 'detail') {\n            parts = [rt.page, rt.item_id];\n        } else {\n            parts = [rt.page, rt.item_id || rt.variant, rt.mode];\n        }\n    } else if (routeInfo.parent_page) {\n        parts = [rt.parent_page, rt.parent_id, rt.page];\n    } else {\n        parts = [rt.page];\n    }\n    if (mapname && mapname != 'main') {\n        parts.push(mapname);\n    }\n    return parts.join('-');\n};\n\nmap.getMap = function(routeInfo, mapname) {\n    var mapid = map.getMapId(routeInfo, mapname);\n    return map.maps[mapid] || null;\n};\n\nmap.getLayers = function(routeInfo, mapname) {\n    var mapid = map.getMapId(routeInfo, mapname);\n    return map.layers[mapid] || null;\n};\n\nmap.getBasemaps = function(routeInfo, mapname) {\n    var mapid = map.getMapId(routeInfo, mapname);\n    return map.basemaps[mapid] || null;\n};\n\n// Primary map routine\nmap.createMap = function(routeInfo, divid, mapname, $page) {\n    var mapid, mapconf, m, defaults, layerConfs, layers, basemaps, basemap, div;\n\n    // Load configuration and div id\n    mapconf = _getConf(routeInfo.page, routeInfo.mode, mapname);\n    defaults = map.config.defaults;\n    mapid = map.getMapId(routeInfo, mapname);\n\n    if (!divid) {\n        if (mapconf.div) {\n            divid = mapconf.div;\n        } else {\n            divid = mapid + '-map';\n        }\n    }\n\n    div = L.DomUtil.get(divid);\n    if (!div) {\n        // Skip map creation if the expected div doesn't exist\n        console.log(divid + ' not found; skipping map creation');\n        return;\n    }\n\n    // Make sure leaflet hasn't already been initialized for this map\n    if (div._leaflet) {\n        // This is probably an onshow event for a page that was rendered\n        // and then went offscreen before coming back; refresh layout.\n        m = map.maps[mapid];\n        m.invalidateSize();\n        if (defaults.autoZoom.sticky) {\n            m.fitBounds(defaults.lastBounds || defaults.bounds);\n        }\n        return;\n    }\n\n    // Create map, set default zoom and basemap\n    var opts = {};\n    if (defaults.maxBounds) {\n        opts.maxBounds = defaults.maxBounds;\n    }\n    m = map.maps[mapid] = L.map(divid, opts);\n    m.fitBounds(defaults.lastBounds || defaults.bounds);\n    basemaps = map.createBasemaps();\n    basemap = Object.keys(basemaps)[0];\n    basemaps[basemap].addTo(m);\n    map.basemaps[mapid] = basemaps;\n\n    // Load layerconfs and add empty layer groups to map\n    layers = {};\n    layerConfs = map.getLayerConfs(routeInfo, mapname);\n    var overlays = layerConfs.map(map.createOverlay);\n    var results = [];\n    layerConfs.forEach(function(layerconf, i) {\n        var layer = overlays[i];\n        layers[layerconf.name] = layer;\n        if (layer.ready) {\n            results.push(layer.ready);\n        }\n        if (!layerconf.noAutoAdd) {\n            layer.addTo(m);\n        }\n    });\n    map.layers[mapid] = layers;\n\n    if (!mapconf.noLayerControl) {\n        map.createLayerControl(basemaps, layers, routeInfo, mapname).addTo(m);\n    }\n\n    Promise.all(results).then(autoZoom);\n\n    function autoZoom() {\n        if (mapconf.autoZoom !== undefined && !mapconf.autoZoom) {\n            return;\n        }\n        if (!map.config.defaults.autoZoom) {\n            return;\n        }\n        var lnames = Object.keys(layers);\n        if (!lnames.length) {\n            return;\n        }\n        var bounds;\n        lnames.forEach(function(lname) {\n            if (!layers[lname].getBounds) {\n                return;\n            }\n            if (!m.hasLayer(layers[lname])) {\n                return;\n            }\n            var layerBounds = layers[lname].getBounds();\n            if (bounds) {\n                bounds.extend(layerBounds);\n            } else if (layerBounds.isValid()) {\n                bounds = layerBounds;\n            }\n        });\n        if (mapconf.minBounds) {\n            if (bounds) {\n                bounds.extend(mapconf.minBounds);\n            } else {\n                bounds = mapconf.minBounds;\n            }\n        } else if (!bounds) {\n            bounds = map.config.defaults.bounds;\n        }\n        setTimeout(function() {\n            m.fitBounds(bounds, map.config.defaults.autoZoom);\n        }, map.config.defaults.autoZoom.wait * 1000);\n    }\n\n    if (map.config.defaults.autoZoom.sticky) {\n        m.on('moveend', function() {\n            const bounds = m.getBounds();\n            if (!bounds.isValid()) {\n                return;\n            }\n            if (bounds.getSouthWest().equals(bounds.getNorthEast())) {\n                return;\n            }\n            map.config.defaults.lastBounds = bounds;\n        });\n    }\n\n    // Ensure valid layout on screen\n    setTimeout(function() {\n        m.invalidateSize();\n    }, 100);\n\n    if (!$page) {\n        return;\n    }\n    // Try to ensure no Leaflet widgets are enhanced by jQuery Mobile\n    var $controls = $page.find('.leaflet-control-container');\n    $controls.find('input').attr('data-role', 'none');\n\n    if (mapconf.onshow) {\n        console.error('wq/map onshow removed in 1.0 - use a wq/app plugin');\n    }\n\n    if (routeInfo.mode == 'edit' && L.Control.Draw) {\n        var drawLayer = null;\n        layerConfs.forEach(function(layerConf) {\n            if (layerConf.draw && layerConf.type == 'geojson') {\n                drawLayer = layerConf;\n            }\n        });\n        if (drawLayer) {\n            var geomname = drawLayer.geometryField || 'geometry';\n            var $geom = $page.find('[name=' + geomname + ']');\n            layers[drawLayer.name].ready.then(function(layer) {\n                map.addDrawControl(m, layer, drawLayer, $geom);\n            });\n        }\n    }\n\n    return m;\n};\n\n// Internal function for creating markers (used with layerconf.icon)\nfunction _makeMarker(icon) {\n    return function pointToLayer(geojson, latlng) {\n        // Define icon as a function to customize per-feature\n        var key;\n        if (typeof icon == 'function') {\n            key = icon(geojson.properties);\n        } else if (icon.indexOf('{{') > -1) {\n            key = tmpl.render(icon, geojson.properties);\n        } else {\n            key = icon;\n        }\n        return L.marker(latlng, { icon: map.icons[key] });\n    };\n}\n\nfunction _makeCluster(clusterIcon) {\n    return function clusterDiv(cluster) {\n        var cls;\n        var context = {\n            count: cluster.getChildCount()\n        };\n        if (context.count >= 100) {\n            context.large = true;\n        } else if (context.count >= 10) {\n            context.medium = true;\n        } else {\n            context.small = true;\n        }\n        if (typeof clusterIcon == 'function') {\n            cls = clusterIcon(context);\n        } else if (clusterIcon.indexOf('{{') > -1) {\n            cls = tmpl.render(clusterIcon, context);\n        } else {\n            cls = clusterIcon;\n        }\n        var html = tmpl.render('<div><span>{{count}}</span></div>', context);\n        return new L.DivIcon({\n            html: html,\n            className: 'marker-cluster ' + cls,\n            iconSize: new L.Point(40, 40)\n        });\n    };\n}\n\n// Load map configuration for a given page\nfunction _getConf(page, mode, mapname) {\n    var conf = map.config.maps[page];\n    if (!conf) {\n        throw 'Configuration for \"' + page + '\" not found!';\n    }\n    if (!mapname) {\n        mapname = 'main';\n    }\n\n    // Start with defaults, override with mode-specific options\n    var mapconf = L.extend(\n        {},\n        conf.defaults.maps[mapname] || {},\n        (conf[mode] || { maps: {} }).maps[mapname] || {}\n    );\n    // Combine (rather than overwrite) defaults + mode-specific layers\n    if (\n        mode &&\n        mode != 'defaults' &&\n        conf.defaults.maps[mapname] &&\n        conf.defaults.maps[mapname].layers\n    ) {\n        mapconf.layers = conf.defaults.maps[mapname].layers.concat(\n            mapconf.layers || []\n        );\n    }\n    if (!mapconf.name) {\n        mapconf.name = conf.name;\n    }\n    if (!mapconf.url) {\n        mapconf.url = conf.url;\n    }\n    return mapconf;\n}\n\nexport default map;\n"],"names":["load","require","e","map","name","config","maps","defaults","bounds","autoZoom","wait","sticky","maxZoom","animate","icon","iconSize","iconAnchor","popupAnchor","shadowSize","basemaps","_defaultBasemaps","layers","icons","default","L","Icon","Default","init","app","loadDraw","geoJson","Proj","shadowUrl","_getIconUrl","extend","Object","keys","pages","forEach","page","pconf","mconf","Array","isArray","mapconf","url","main","conf","mode","modes","list","autoLayers","addAutoLayers","run","$page","routeInfo","mapname","divid","getMapId","$div","find","createMap","addLayerConf","layerconf","type","createOverlay","push","createIcon","options","onEachFeature","callback","listConf","_getConf","popup","cluster","detailConf","editConf","flatten","draw","polygon","polyline","marker","rectangle","circle","getLayerConfs","itemid","item_id","path","outboxId","outbox_id","parts","split","baseurl","replace","params","indexOf","tmpl","render","id","item","geomname","geometryField","geom","context","initData","JSON","parse","features","cache","loadLayer","service","Promise","resolve","match","spin","start","store","ajax","then","geojson","stop","cdn","attr","document","location","protocol","layer","attribution","createBasemaps","createBasemap","fn","addBasemapType","layerConf","tileLayer","addOverlayType","overlay","MarkerClusterGroup","clusterIcon","iconCreateFunction","_makeCluster","featureGroup","getData","ready","oneach","console","warn","renderPopup","feat","pointToLayer","_makeMarker","style","geometry","geometries","gjLayer","getLayers","addTo","createLayerControl","control","addDrawControl","m","$geom","Control","Draw","edit","on","addLayer","save","$submit","parents","geoms","feature","addGeometry","length","toGeoJSON","val","stringify","attrs","properties","bindPopup","rt","variant","parent_page","parent_id","join","getMap","mapid","getBasemaps","layerConfs","basemap","div","DomUtil","get","log","_leaflet","invalidateSize","fitBounds","lastBounds","opts","maxBounds","overlays","results","i","noAutoAdd","noLayerControl","all","undefined","lnames","lname","getBounds","hasLayer","layerBounds","isValid","minBounds","setTimeout","getSouthWest","equals","getNorthEast","$controls","onshow","error","drawLayer","latlng","key","clusterDiv","cls","count","getChildCount","large","medium","small","html","DivIcon","className","Point","concat"],"mappings":"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"}