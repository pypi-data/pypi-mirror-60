(function(t){function e(e){for(var o,r,c=e[0],u=e[1],a=e[2],l=0,f=[];l<c.length;l++)r=c[l],Object.prototype.hasOwnProperty.call(s,r)&&s[r]&&f.push(s[r][0]),s[r]=0;for(o in u)Object.prototype.hasOwnProperty.call(u,o)&&(t[o]=u[o]);p&&p(e);while(f.length)f.shift()();return i.push.apply(i,a||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],o=!0,c=1;c<n.length;c++){var u=n[c];0!==s[u]&&(o=!1)}o&&(i.splice(e--,1),t=r(r.s=n[0]))}return t}var o={},s={app:0},i=[];function r(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=o,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/static/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],u=c.push.bind(c);c.push=e,c=c.slice();for(var a=0;a<c.length;a++)e(c[a]);var p=u;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var o=n("85ec"),s=n.n(o);s.a},"13d9":function(t,e,n){},2564:function(t,e,n){},"43d9":function(t,e,n){"use strict";var o=n("13d9"),s=n.n(o);s.a},"45c2":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("2b0e"),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("Canvas",{attrs:{workflow:t.workflow},on:{stepremove:t.removeStep,stepmove:t.moveStep,setinputparameter:t.setInputParameter,setconnection:t.setConnection,removeconnection:t.removeConnection}}),n("Library",{attrs:{components:t.components},on:{add:t.addStep}})],1)},i=[],r=(n("a4d3"),n("e01a"),n("d28b"),n("d3b7"),n("3ca3"),n("ddb0"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"canvas"},t._l(t.workflow.steps,(function(e){return n("Step",{key:e.id,attrs:{step:e},on:{setport:t.setPort,stepmove:t.moveStep,remove:function(n){return t.removeStep(e.id)},setinputparameter:t.setInputParameter}})})),1),n("svg",{staticClass:"canvas ports"},t._l(this.ports,(function(e){return n("Port",{key:e.key,attrs:{port:e},on:{startconnection:t.startConnection,grabconnection:t.grabConnection}})})),1),n("svg",{staticClass:"canvas connections"},[t._l(t.connections,(function(t){return n("Connection",{key:t.key,attrs:{source:t.source,dest:t.dest}})})),null!=t.newConnection?n("Connection",{attrs:{source:t.newConnection.source,dest:t.newConnection.dest}}):t._e()],2)])}),c=[],u=(n("99af"),n("4fad"),n("3835")),a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"step",style:t.style,on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])?null:"button"in e&&0!==e.button?null:e.target!==e.currentTarget?null:(e.preventDefault(),t.mousedown(e))}}},[n("a",{staticClass:"close",on:{click:function(e){return e.target!==e.currentTarget?null:(e.preventDefault(),t.remove(e))}}},[t._v("[x]")]),n("h2",[t._v(t._s(t.step.component.type))]),n("table",{staticClass:"outputs"},t._l(t.outputs,(function(e){return n("tr",{key:e},[n("td",[t._v("???")]),n("td",[t._v(t._s(e))])])})),0),n("table",{staticClass:"inputs"},t._l(t.inputs,(function(e){return n("tr",{key:e[0]},[n("td",[t._v(t._s(e[0]))]),n("td",[null!==e[1]?n("input",{attrs:{type:"text"},domProps:{value:e[1]},on:{change:function(n){return t.changeInput(e[0],n)}}}):t._e()])])})),0)])},p=[];n("fb6a"),n("4e82");function l(t,e){t.sort((function(t,n){return e(t)<e(n)?-1:e(t)>e(n)?1:0}))}var f={name:"Step",props:["step"],computed:{inputs:function(){var t=Object.entries(this.step.inputs);l(t,(function(t){return t[0]}));for(var e=0;e<t.length;++e)0==t[e][1].length?t[e][1]="":"string"!=typeof t[e][1][0]&&(t[e][1]=null);return t},outputs:function(){var t=this.step.outputs.slice();return t.sort(),t},style:function(){return"left: ".concat(this.step.position[0],"px; top: ").concat(this.step.position[1],"px;")}},methods:{sendUpdate:function(){for(var t=this.$el.querySelectorAll(".outputs tr"),e=0;e<t.length;++e){var n=t[e].getBoundingClientRect();this.$emit("setport",{key:"".concat(this.step.id,".out.").concat(this.step.outputs[e]),type:"output",step_id:this.step.id,port_name:this.step.outputs[e],position:[n.right+6,(n.top+n.bottom)/2]})}for(var o=this.$el.querySelectorAll(".inputs tr"),s=0;s<o.length;++s){var i=o[s].getBoundingClientRect();this.$emit("setport",{key:"".concat(this.step.id,".in.").concat(this.inputs[s][0]),type:"input",step_id:this.step.id,port_name:this.inputs[s][0],position:[i.left-6,(i.top+i.bottom)/2]})}},changeInput:function(t,e){this.$emit("setinputparameter",{step_id:this.step.id,input_name:t,value:e.target.value})},mousedown:function(t){document.addEventListener("mouseup",this.mouseup),document.addEventListener("mousemove",this.mousemove),this.offset=[this.step.position[0]-t.clientX,this.step.position[1]-t.clientY]},mouseup:function(){document.removeEventListener("mouseup",this.mouseup),document.removeEventListener("mousemove",this.mousemove),this.$emit("stepmove",{step_id:this.step.id,position:this.step.position})},mousemove:function(t){t.preventDefault(),this.step.position=[t.clientX+this.offset[0],t.clientY+this.offset[1]]},remove:function(){this.$emit("remove")}},mounted:function(){this.$nextTick(this.sendUpdate)},updated:function(){this.$nextTick(this.sendUpdate)},beforeDestroy:function(){document.removeEventListener("mousemove",this.mousemoved),document.removeEventListener("mouseup",this.mouseup);var t=!0,e=!1,n=void 0;try{for(var o,s=this.step.outputs[Symbol.iterator]();!(t=(o=s.next()).done);t=!0){var i=o.value;this.$emit("setport",{key:"".concat(this.step.id,".out.").concat(i),position:void 0})}}catch(f){e=!0,n=f}finally{try{t||null==s.return||s.return()}finally{if(e)throw n}}var r=!0,c=!1,u=void 0;try{for(var a,p=this.inputs[Symbol.iterator]();!(r=(a=p.next()).done);r=!0){var l=a.value;this.$emit("setport",{key:"".concat(this.step.id,".in.").concat(l[0]),position:void 0})}}catch(f){c=!0,u=f}finally{try{r||null==p.return||p.return()}finally{if(c)throw u}}}},d=f,v=(n("c32d"),n("2877")),m=Object(v["a"])(d,a,p,!1,null,"099194f5",null),h=m.exports,_=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("circle",{class:t.port.type,attrs:{cx:t.port.position[0],cy:t.port.position[1]},on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])?null:"button"in e&&0!==e.button?null:e.target!==e.currentTarget?null:(e.preventDefault(),t.mousedown(e))}}})},y=[],w={name:"Port",props:["port"],methods:{mousedown:function(){"output"==this.port.type?this.$emit("startconnection",this.port.key):this.$emit("grabconnection",this.port.key)}}},b=w,k=(n("43d9"),Object(v["a"])(b,_,y,!1,null,"78c28052",null)),g=k.exports,C=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("path",{staticClass:"connection",attrs:{d:t.path}})},S=[],O={name:"Connection",props:["source","dest"],computed:{path:function(){var t=Object(u["a"])(this.source,2),e=t[0],n=t[1],o=Object(u["a"])(this.dest,2),s=o[0],i=o[1];return"M ".concat(e," ").concat(n," C ").concat(e+40," ").concat(n," ").concat(s-40," ").concat(i," ").concat(s," ").concat(i)}}},$=O,x=(n("8712"),Object(v["a"])($,C,S,!1,null,"83056670",null)),L=x.exports,E={name:"Canvas",props:["workflow"],data:function(){return{ports:{},newConnection:null}},computed:{connections:function(){var t={},e={},n={};for(var o in this.workflow.steps){var s=this.workflow.steps[o],i=0;t[o]={};var r=!0,c=!1,a=void 0;try{for(var p,f=s.outputs[Symbol.iterator]();!(r=(p=f.next()).done);r=!0){var d=p.value;t[o][d]=i++}}catch(T){c=!0,a=T}finally{try{r||null==f.return||f.return()}finally{if(c)throw a}}e[o]=i;var v=0;n[o]={};var m=Object.entries(s.inputs);l(m,(function(t){return t[0]}));for(var h=0,_=m;h<_.length;h++){var y=Object(u["a"])(_[h],1),w=y[0];n[o][w]=v++}}var b=[];for(var k in this.workflow.steps){var g=this.workflow.steps[k];for(var C in g.inputs){var S=g.inputs[C],O=!0,$=!1,x=void 0;try{for(var L,E=S[Symbol.iterator]();!(O=(L=E.next()).done);O=!0){var j=L.value;if("string"!=typeof j){var P="".concat(j.step_id,".out.").concat(j.output_name);if(!(P in this.ports))continue;var M=this.ports[P].position,J="".concat(k,".in.").concat(C);if(!(J in this.ports))continue;var U=this.ports[J].position;b.push({key:"".concat(P,".").concat(J),source_step_id:j.step_id,source_output_name:j.output_name,dest_step_id:k,dest_input_name:C,source:M,dest:U})}}}catch(T){$=!0,x=T}finally{try{O||null==E.return||E.return()}finally{if($)throw x}}}}return b}},methods:{setPort:function(t){void 0!==t.position?this.$set(this.ports,t.key,t):this.$delete(this.ports,t.key)},moveStep:function(t){this.$emit("stepmove",t)},removeStep:function(t){this.$emit("stepremove",t)},setInputParameter:function(t){this.$emit("setinputparameter",t)},startConnection:function(t){var e=this.ports[t];this.newConnection={key:"".concat(t,"."),source_step_id:e.step_id,source_output_name:e.port_name,source:e.position,dest:[event.clientX,event.clientY]},document.addEventListener("mouseup",this.connectionMouseUp),document.addEventListener("mousemove",this.connectionMouseMove)},grabConnection:function(t){var e=null,n=!0,o=!1,s=void 0;try{for(var i,r=this.connections[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var c=i.value;if("".concat(c.dest_step_id,".in.").concat(c.dest_input_name)==t){this.$emit("removeconnection",{step_id:c.dest_step_id,input_name:c.dest_input_name,source_step_id:c.source_step_id,source_output_name:c.source_output_name}),e="".concat(c.source_step_id,".out.").concat(c.source_output_name);break}}}catch(u){o=!0,s=u}finally{try{n||null==r.return||r.return()}finally{if(o)throw s}}null!==e&&this.startConnection(e)},connectionMouseUp:function(t){document.removeEventListener("mouseup",this.connectionMouseUp),document.removeEventListener("mousemove",this.connectionMouseMove);var e=null,n=150;for(var o in this.ports){var s=this.ports[o];if("input"==s.type){var i=s.position[0]-t.clientX,r=s.position[1]-t.clientY,c=i*i+r*r;c<n&&(n=c,e=s)}}null!==e&&this.$emit("setconnection",{step_id:e.step_id,input_name:e.port_name,source_step_id:this.newConnection.source_step_id,source_output_name:this.newConnection.source_output_name}),this.newConnection=null},connectionMouseMove:function(t){this.newConnection.dest=[t.clientX,t.clientY]}},beforeDestroy:function(){document.removeEventListener("mouseup",this.connectionMouseUp),document.removeEventListener("mousemove",this.connectionMouseMove)},components:{Step:h,Port:g,Connection:L}},j=E,P=(n("a2f2"),Object(v["a"])(j,r,c,!1,null,"00206153",null)),M=P.exports,J=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"library"},[n("div",[n("div",[n("h1",[t._v("Workflow library")]),t._l(t.components,(function(e){return n("p",{key:e.component_def.type},[n("button",{on:{click:function(n){return t.add(e)}}},[t._v(t._s(e.label))])])}))],2)])])},U=[],T={name:"Library",props:["components"],methods:{add:function(t){this.$emit("add",t)}}},I=T,N=(n("e53f"),Object(v["a"])(I,J,U,!1,null,"e80fe0b0",null)),A=N.exports,D={name:"App",data:function(){return{websocket:null,workflow:{steps:{}},components:[]}},methods:{addStep:function(t){this.websocket.send(JSON.stringify({type:"workflow_add_step",component_def:t.component_def,position:[10,10]}))},removeStep:function(t){this.websocket.send(JSON.stringify({type:"workflow_remove_step",step_id:t}))},moveStep:function(t){var e=t.step_id,n=t.position;this.websocket.send(JSON.stringify({type:"workflow_move_step",step_id:e,position:n}))},setInputParameter:function(t){this.websocket.send(JSON.stringify({type:"workflow_set_input_parameter",step_id:t.step_id,input_name:t.input_name,value:t.value}))},setConnection:function(t){this.websocket.send(JSON.stringify({type:"workflow_set_input_connection",step_id:t.step_id,input_name:t.input_name,source_step_id:t.source_step_id,source_output_name:t.source_output_name}))},removeConnection:function(t){this.websocket.send(JSON.stringify({type:"workflow_remove_inputs",step_id:t.step_id,input_name:t.input_name}))}},created:function(){var t=window.API_WS_URL;"/"!=t.substring(t.length-1)&&(t+="/"),t+="workflow";var e=this;this.websocket=new WebSocket(t),this.websocket.addEventListener("open",(function(){console.log("Connected")})),this.websocket.addEventListener("close",(function(){console.error("Connection closed")})),this.websocket.addEventListener("message",(function(t){var n=JSON.parse(t.data);if("workflow"==n.type)e.workflow=n.workflow;else if("components_add"==n.type){var o=!0,s=!1,i=void 0;try{for(var r,c=n.components[Symbol.iterator]();!(o=(r=c.next()).done);o=!0){var u=r.value;e.components.push(u)}}catch(a){s=!0,i=a}finally{try{o||null==c.return||c.return()}finally{if(s)throw i}}}else"workflow_remove_step"==n.type?e.$delete(e.workflow.steps,n.step_id):console.error("Unrecognized message from server: ",n)}))},components:{Canvas:M,Library:A}},X=D,Y=(n("034f"),Object(v["a"])(X,s,i,!1,null,null,null)),R=Y.exports;o["a"].config.productionTip=!1,new o["a"]({render:function(t){return t(R)}}).$mount("#app")},"6b6f":function(t,e,n){},"85ec":function(t,e,n){},8712:function(t,e,n){"use strict";var o=n("2564"),s=n.n(o);s.a},a2f2:function(t,e,n){"use strict";var o=n("a7c7"),s=n.n(o);s.a},a7c7:function(t,e,n){},c32d:function(t,e,n){"use strict";var o=n("45c2"),s=n.n(o);s.a},e53f:function(t,e,n){"use strict";var o=n("6b6f"),s=n.n(o);s.a}});
//# sourceMappingURL=app.664c5b71.js.map