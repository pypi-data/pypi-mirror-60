#AUTOGENERATED! DO NOT EDIT! File to edit: dev/00_pplyr_core.ipynb (unless otherwise specified).

__all__ = ['pplyr']

#Cell

import pandas as pd
from os import system
from tempfile import NamedTemporaryFile

def pplyr(df, cmd):
    """
    Writes dataframe to csv, creates R script with dplyer code, calls R script and re-reads the output of the script.
    See https://github.com/fdewes/pplyer for docs / examples.
    """
    data_file = NamedTemporaryFile()
    script_file = NamedTemporaryFile()

    libs = ("library(dplyr); library(data.table)")
    load = ("df = fread('" + data_file.name + "') %>% as.data.frame()")
    write = ("fwrite(df, '" + data_file.name + "')")
    df.to_csv(data_file.name)

    with open(script_file.name, "w") as f:
        f.write(libs + "\n")
        f.write(load + "\n")
        f.write("df = " + cmd + "\n")
        f.write(write + "\n")

    system("Rscript " + script_file.name)
    df = pd.read_csv(data_file.name)
    return df
