
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>How-to: Writing setup handlers for Products.GenericSetup &#8212; Products.GenericSetup 2.0.2.dev0 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="About Profiles" href="profiles.html" />
    <link rel="prev" title="Installing Products.GenericSetup" href="install.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="profiles.html" title="About Profiles"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="install.html" title="Installing Products.GenericSetup"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Products.GenericSetup 2.0.2.dev0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="how-to-writing-setup-handlers-for-products-genericsetup">
<span id="writing-handlers"></span><h1>How-to: Writing setup handlers for <code class="docutils literal notranslate"><span class="pre">Products.GenericSetup</span></code><a class="headerlink" href="#how-to-writing-setup-handlers-for-products-genericsetup" title="Permalink to this headline">¶</a></h1>
<p>If your product subclasses existing tools or provides new tools (or new
sub-object classes), it might need to supply its own setup handlers in
order to support exporting / importing tool settings using GenericSetup.</p>
<div class="section" id="step-1">
<h2>Step 1:<a class="headerlink" href="#step-1" title="Permalink to this headline">¶</a></h2>
<p>Identify those classes in your product that need their own setup handlers.
In theory you don’t need your own handlers for classes which implement a
CMF tool interface that already has a setup adapter.  In practice the
adapters shipped with the CMF sometimes use methods that are not part of
the interface, so you have to verify that they really work for your classes.</p>
</div>
<div class="section" id="step-2">
<h2>Step 2:<a class="headerlink" href="#step-2" title="Permalink to this headline">¶</a></h2>
<p>Make sure those classes that need setup handlers have Zope3 style
interfaces.  Later you will write setup adapters for those interfaces.</p>
</div>
<div class="section" id="step-3">
<h2>Step 3:<a class="headerlink" href="#step-3" title="Permalink to this headline">¶</a></h2>
<p>Create an <code class="docutils literal notranslate"><span class="pre">exportimport</span></code> module inside your product. If you plan to write
many setup handlers this can be a sub-package.</p>
</div>
<div class="section" id="step-4">
<h2>Step 4:<a class="headerlink" href="#step-4" title="Permalink to this headline">¶</a></h2>
<p>Decide which kind of setup handler you need:</p>
<dl class="simple">
<dt>body adapter</dt><dd><p>For objects represented by a complete file body. Provides
<code class="docutils literal notranslate"><span class="pre">Products.GenericSetup.interfaces.IBody</span></code>.</p>
</dd>
<dt>XML adapter</dt><dd><p>A ‘body adapter’ in XML format. Also provides
<code class="docutils literal notranslate"><span class="pre">Products.GenericSetup.interfaces.IBody</span></code>, but has its own
base class because XML is the preferred format.</p>
</dd>
<dt>node adapter</dt><dd><p>For sub-objects represented by an XML node of the parent’s XML document.
Provides <code class="docutils literal notranslate"><span class="pre">Products.GenericSetup.interfaces.INode</span></code>. This is useful for
sub-objects of complex tools. Custom catalog index or action classes
need this kind of adapter.</p>
</dd>
<dt>import and export steps</dt><dd><p>Top level handlers can be registered to manage import steps and / or export
steps and call the body adapters.</p>
</dd>
</dl>
<p>If you use the base classes from <code class="xref py py-mod docutils literal notranslate"><span class="pre">Products.GenericSetup.utils</span></code>, XML and
node adapters are implemented in a very similar way. Both can mix in
<code class="docutils literal notranslate"><span class="pre">ObjectManagerHelpers</span></code> and <code class="docutils literal notranslate"><span class="pre">PropertyManagerHelpers</span></code>.</p>
</div>
<div class="section" id="step-5">
<h2>Step 5:<a class="headerlink" href="#step-5" title="Permalink to this headline">¶</a></h2>
<p><code class="xref py py-mod docutils literal notranslate"><span class="pre">Products.CMFCore.exportimport</span></code> contains many examples for XML and
node adapters. If you need a pure body adapter,
<code class="xref py py-mod docutils literal notranslate"><span class="pre">Products.GenericSetup.PythonScripts</span></code> would be a good
example. Follow those examples and write your own multi adapter, register
it for the interface of your class and for
<code class="docutils literal notranslate"><span class="pre">Products.GenericSetup.interfaces.ISetupEnviron</span></code> and don’t forget
to write unit tests.</p>
<p>Adapters follow the convention that <code class="docutils literal notranslate"><span class="pre">self.context</span></code> is always the primary
adapted object, so the minimal setup context (<code class="docutils literal notranslate"><span class="pre">ISetupEnviron</span></code>) used in these
multi adapters is <code class="docutils literal notranslate"><span class="pre">self.environ</span></code>.</p>
<p>XML and body adapters are always also small node adapters. This way the
XML file of the container contains the information that is necessary to
create an empty object. The handler of the container has to set up
sub-objects before we can adapt them and configure them with their own
handlers. The base classes in <code class="xref py py-mod docutils literal notranslate"><span class="pre">Products.GenericSetup.utils</span></code>
will care about that.</p>
</div>
<div class="section" id="step-6">
<h2>Step 6:<a class="headerlink" href="#step-6" title="Permalink to this headline">¶</a></h2>
<p>If your adapter is a top-level adapter (e.g for a tool), you need import
and export steps that know how to use the adapter. Again there are many
examples in <code class="xref py py-mod docutils literal notranslate"><span class="pre">Products.CMFCore.exportimport</span></code>.</p>
<p>To make those steps available you have to add them to <code class="docutils literal notranslate"><span class="pre">export_steps.xml</span></code>
and <code class="docutils literal notranslate"><span class="pre">import_steps.xml</span></code> of a setup profile and to load that profile into the
setup tool.</p>
</div>
<div class="section" id="step-7">
<h2>Step 7:<a class="headerlink" href="#step-7" title="Permalink to this headline">¶</a></h2>
<p>Now you are done. To ship default settings with your product, make your
settings through the ZMI (or set your stuff up the old way if you have old
setup code like an <code class="docutils literal notranslate"><span class="pre">Install.py</span></code>) and export your settings using the setup
tool.  Unpack the exported tarball into a <code class="docutils literal notranslate"><span class="pre">profiles</span></code> subdirectory of your
product, and then add <code class="docutils literal notranslate"><span class="pre">gs:registerProfile</span></code> entries to its <code class="docutils literal notranslate"><span class="pre">configure.zcml</span></code>
file to register that directory as a <a class="reference internal" href="glossary.html#term-base-profile"><span class="xref std std-term">base profile</span></a> or
<a class="reference internal" href="glossary.html#term-extension-profile"><span class="xref std std-term">extension profile</span></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>See <a class="reference internal" href="profiles.html#about-profiles"><span class="std std-ref">About Profiles</span></a> for more details.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">How-to: Writing setup handlers for <code class="docutils literal notranslate"><span class="pre">Products.GenericSetup</span></code></a><ul>
<li><a class="reference internal" href="#step-1">Step 1:</a></li>
<li><a class="reference internal" href="#step-2">Step 2:</a></li>
<li><a class="reference internal" href="#step-3">Step 3:</a></li>
<li><a class="reference internal" href="#step-4">Step 4:</a></li>
<li><a class="reference internal" href="#step-5">Step 5:</a></li>
<li><a class="reference internal" href="#step-6">Step 6:</a></li>
<li><a class="reference internal" href="#step-7">Step 7:</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="install.html"
                        title="previous chapter">Installing <code class="xref py py-mod docutils literal notranslate"><span class="pre">Products.GenericSetup</span></code></a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="profiles.html"
                        title="next chapter">About Profiles</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/handlers.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="profiles.html" title="About Profiles"
             >next</a> |</li>
        <li class="right" >
          <a href="install.html" title="Installing Products.GenericSetup"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Products.GenericSetup 2.0.2.dev0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2008-2017, Zope CMF Developers.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.3.1.
    </div>
  </body>
</html>