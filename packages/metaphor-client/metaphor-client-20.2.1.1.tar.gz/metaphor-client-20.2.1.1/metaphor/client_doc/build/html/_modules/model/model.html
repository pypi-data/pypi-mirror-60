

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>model.model &#8212; metaphor_client 0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../metaphor_client.html">metaphor_client 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for model.model</h1><div class="highlight"><pre>
<span></span><span class="c1">#----------------------------------------------------------------------------</span>
<span class="c1"># -*- coding: UTF-8 -*-</span>
<span class="c1"># $Id$</span>
<span class="c1">#</span>
<span class="c1"># Copyright 2016 Jean-Luc PLOIX</span>
<span class="c1"># </span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1"># </span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1"># </span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="c1">#----------------------------------------------------------------------------</span>
<span class="sd">&quot;&quot;&quot;High level client interface for Metaphor server.</span>

<span class="sd">This module exposes a first contact with the server, and two classes, *User* and </span>
<span class="sd">*Model*.</span>
<span class="sd">It contact the metaphor server through calls the low level interface *api_client*.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">metaphor.api_client</span> <span class="k">import</span> <span class="n">initiate_connection</span><span class="p">,</span> <span class="n">add_user</span><span class="p">,</span> <span class="n">delete_user</span><span class="p">,</span> \
    <span class="n">load_model</span><span class="p">,</span> <span class="n">create_model</span><span class="p">,</span> <span class="n">get_function</span><span class="p">,</span> <span class="n">post_function</span><span class="p">,</span> <span class="n">get_model_attribute</span><span class="p">,</span>\
    <span class="n">post_file</span><span class="p">,</span> <span class="n">delete_models</span>  
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<div class="viewcode-block" id="User"><a class="viewcode-back" href="../../model.html#model.model.User">[docs]</a><span class="k">class</span> <span class="nc">User</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;User management class.</span>
<span class="sd">    </span>
<span class="sd">    Every instance of this class represent an accepted user.</span>
<span class="sd">    </span>
<span class="sd">    parameter:</span>
<span class="sd">    </span>
<span class="sd">      - user_name -&gt; name of the user. To be checked and registered by th e server.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_user_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">_user_id</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_name</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">add_user</span><span class="p">(</span><span class="n">user_name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_user_name</span> <span class="o">=</span> <span class="n">user_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_user_id</span> <span class="o">=</span> <span class="n">result</span>
            
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;Metaphor server user:</span>
<span class="s2">        </span><span class="si">{0}</span><span class="s2"></span>
<span class="s2">        </span><span class="si">{1}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
    
<div class="viewcode-block" id="User.delete"><a class="viewcode-back" href="../../model.html#model.model.User.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Unregistering the user</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">delete_user</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">result</span></div>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">user_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Id of the registered user</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_id</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">user_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Name of the registered user</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_name</span></div>
    

<div class="viewcode-block" id="Model"><a class="viewcode-back" href="../../model.html#model.model.Model">[docs]</a><span class="k">class</span> <span class="nc">Model</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Model initialization.</span>
<span class="sd">    </span>
<span class="sd">    user -&gt; a registered user</span>
<span class="sd">    </span>
<span class="sd">    loaddata -&gt; a dictionary with keys:</span>
<span class="sd">    </span>
<span class="sd">        -&gt; source contains the information for the model to create.</span>
<span class="sd">        </span>
<span class="sd">            source may be:</span>
<span class="sd">            - XML text</span>
<span class="sd">            - file name containing the XML text</span>
<span class="sd">            - nnx of gmx file, produced by a training process</span>
<span class="sd">            </span>
<span class="sd">        -&gt; modelname is the name to be given to the model created. This value will overwrite a model name optionaly registered within the source file.</span>
<span class="sd">        </span>
<span class="sd">        -&gt; descriptor is a small word describing the model. For the GraphMachine models, this parameter will be the smiles code of the molecule to be modelized.</span>
<span class="sd">            </span>
<span class="sd">    modeldata -&gt; a dictionary describing a model to create. It has the </span>
<span class="sd">        highest priority to create the model.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_owner_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_model_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_modelname</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">loaddata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">modeldata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
        <span class="nb">super</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span class="c1">#         self._owner_id = user.user_id</span>
        <span class="k">if</span> <span class="n">modeldata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">create_model</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">modeldata</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">loaddata</span><span class="p">[</span><span class="s1">&#39;docompile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">loaddata</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span><span class="p">,</span> <span class="n">modDict</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="n">modDict</span> <span class="o">=</span> <span class="n">modDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;models&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">modDict</span> <span class="o">=</span> <span class="n">modDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modelname</span> <span class="o">=</span> <span class="n">modDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_description</span> <span class="o">=</span> <span class="n">modDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    
<div class="viewcode-block" id="Model.createFromData"><a class="viewcode-back" href="../../model.html#model.model.Model.createFromData">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">createFromData</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">datasource</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">hidden</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dataformat</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> 
            <span class="n">arange</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;nn&quot;</span><span class="p">,</span> <span class="n">forcecreate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Model initialization from data set.</span>
<span class="sd">        </span>
<span class="sd">        user -&gt; a registered user</span>
<span class="sd">        </span>
<span class="sd">        datasource -&gt; source file from the client side. It will be transfered to</span>
<span class="sd">        the server side with the &#39;post_file&#39; method.</span>
<span class="sd">        </span>
<span class="sd">        hidden -&gt; number of hidden nodes</span>
<span class="sd">        </span>
<span class="sd">        dataformat -&gt; data format string</span>
<span class="sd">        </span>
<span class="sd">        arange -&gt; range of data (excel files)</span>
<span class="sd">        </span>
<span class="sd">        headers -&gt; Heuh!!!</span>
<span class="sd">        </span>
<span class="sd">        mode -&gt; nn or gm</span>
<span class="sd">        </span>
<span class="sd">        forcecreate -&gt; boolean</span>
<span class="sd">        </span>
<span class="sd">        return the handle of the created model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">user_id</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">user_id</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">user_id</span> <span class="o">=</span> <span class="n">user</span>
        
        <span class="n">source_id</span> <span class="o">=</span> <span class="n">post_file</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">datasource</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;trainable&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;datasource&#39;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">,</span>
                <span class="s1">&#39;hidden&#39;</span><span class="p">:</span> <span class="n">hidden</span><span class="p">,</span>
                <span class="s1">&#39;dataformat&#39;</span><span class="p">:</span> <span class="n">dataformat</span><span class="p">,</span>
                <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="n">arange</span><span class="p">,</span>
                <span class="s1">&#39;headers&#39;</span><span class="p">:</span> <span class="n">headers</span><span class="p">,</span>
                <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="n">mode</span><span class="p">,</span>
                <span class="s1">&#39;forcecreate&#39;</span><span class="p">:</span> <span class="n">forcecreate</span><span class="p">,</span>
                <span class="p">}</span>
<span class="c1">#                </span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>
    
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span><span class="p">:</span>
            <span class="c1">#data = {&#39;delete&#39;: self._model_id}</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">delete_models</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">paramCount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the size of the parameter vector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">get_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span><span class="p">,</span> <span class="s1">&#39;paramCount&#39;</span><span class="p">))</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dataCount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the size of the training database.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">get_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span><span class="p">,</span> <span class="s1">&#39;dataCount&#39;</span><span class="p">))</span>
    
<div class="viewcode-block" id="Model.newWeights"><a class="viewcode-back" href="../../model.html#model.model.Model.newWeights">[docs]</a>    <span class="k">def</span> <span class="nf">newWeights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stddev</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">bias0</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">doset</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate a new parameter vector.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        </span>
<span class="sd">        - stddev -&gt; standard deviation of the random distribution generated. Default 0.3</span>
<span class="sd">        - bias0 -&gt; set the linear parameters to 0. Default True</span>
<span class="sd">        - doset -&gt; if True, set the model weights to the generated vector</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stddev&#39;</span><span class="p">:</span> <span class="n">stddev</span><span class="p">,</span> <span class="s1">&#39;bias0&#39;</span><span class="p">:</span> <span class="n">bias0</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">get_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span><span class="p">,</span> <span class="s1">&#39;newWeights&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">doset</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="Model.trainigData"><a class="viewcode-back" href="../../model.html#model.model.Model.trainigData">[docs]</a>    <span class="k">def</span> <span class="nf">trainigData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the training data set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;prefix&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">get_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span><span class="p">,</span> <span class="s1">&#39;getTrainingData&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span></div>
    
<span class="c1">#    def transfer(self, inputs=None, indexmove=-1, indexlist=None, weights=None):</span>
<div class="viewcode-block" id="Model.transfer"><a class="viewcode-back" href="../../model.html#model.model.Model.transfer">[docs]</a>    <span class="k">def</span> <span class="nf">transfer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">indexlist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Command a transfer through the model. </span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        </span>
<span class="sd">        - inputs -&gt; inputs to use. If None, last used inputs are used. Only if index is &lt; 0.</span>
<span class="sd">        - index -&gt; if indexlist is None, index of the inputs in the training data base, else index of the input vector to be tested with different values.</span>
<span class="sd">        - indexlist -&gt; data to use in the inputs in the index position</span>
<span class="sd">        - weights -&gt; the parameter set to use. If None, the current weights is used.</span>
<span class="sd">        </span>
<span class="sd">        Return result of the transfer, i.e. a float or a list of float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span> <span class="k">if</span> <span class="n">inputs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">]</span>
        <span class="n">indexlist</span> <span class="o">=</span> <span class="n">indexlist</span> <span class="k">if</span> <span class="n">indexlist</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">indexlist</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">indexlist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;inputs&#39;</span><span class="p">:</span> <span class="n">inputs</span><span class="p">,</span>
                    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span>
                    <span class="s1">&#39;weights&#39;</span><span class="p">:</span> <span class="n">weights</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;inputs&#39;</span><span class="p">:</span> <span class="n">inputs</span><span class="p">,</span>
                    <span class="s1">&#39;indexmove&#39;</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span>
                    <span class="s1">&#39;weights&#39;</span><span class="p">:</span> <span class="n">weights</span><span class="p">,</span>
                    <span class="s1">&#39;indexlist&#39;</span><span class="p">:</span> <span class="n">indexlist</span><span class="p">,}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">post_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span><span class="p">,</span> <span class="s1">&#39;transfer&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">res</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="Model.train"><a class="viewcode-back" href="../../model.html#model.model.Model.train">[docs]</a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
              <span class="n">startWeights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
              <span class="n">epochs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
              <span class="n">trainstyle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
              <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Launch a training job.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        </span>
<span class="sd">        - startWeights -&gt; parameter vector to use at the beginning.</span>
<span class="sd">        - epochs -&gt; maximum number of epochs of the training job.</span>
<span class="sd">        - trainstyle -&gt; unused. Kepp the default</span>
<span class="sd">        - callback -&gt; unused. Kepp the default</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;startWeights&#39;</span><span class="p">:</span> <span class="n">startWeights</span><span class="p">,</span>
            <span class="s1">&#39;epochs&#39;</span><span class="p">:</span> <span class="n">epochs</span><span class="p">,</span>
            <span class="s1">&#39;trainstyle&#39;</span><span class="p">:</span> <span class="n">trainstyle</span><span class="p">,</span>
            <span class="s1">&#39;callback&#39;</span><span class="p">:</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">post_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span><span class="p">,</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>
    
<div class="viewcode-block" id="Model.reverse_train"><a class="viewcode-back" href="../../model.html#model.model.Model.reverse_train">[docs]</a>    <span class="k">def</span> <span class="nf">reverse_train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freeinputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">epochs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fullres</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Launch a reverse training job. This will compute an input set for </span>
<span class="sd">        which the model gives an output close to a target value. Available only </span>
<span class="sd">        for single models with non zero input number.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        </span>
<span class="sd">        - target -&gt; targeted output value.</span>
<span class="sd">        - imputs -&gt; starting input values</span>
<span class="sd">        - freeinputs -&gt; list of the free inputs (names or indexes in input list).</span>
<span class="sd">        - epochs -&gt; maximum number of epochs of the reverse training job.</span>
<span class="sd">        - callback -&gt; unused. Kepp the default</span>
<span class="sd">        - debug -&gt; unused. Keep the default</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="c1">#         print(&quot;initial inputs&quot;, inputs)</span>
<span class="c1">#         print(&quot;freeinputs&quot;, freeinputs)</span>
<span class="c1">#         if epochs is None or epochs &lt;= 0:</span>
<span class="c1">#             epochs = 100</span>
<span class="c1">#         fullres = True</span>
        <span class="n">withhistory</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;outputtarget&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">target</span><span class="p">),</span>
                <span class="s1">&#39;inputs&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">],</span>
                <span class="s1">&#39;freeinputs&#39;</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">freeinputs</span><span class="p">],</span>
                <span class="s1">&#39;epochs&#39;</span><span class="p">:</span> <span class="n">epochs</span> <span class="k">if</span> <span class="n">epochs</span> <span class="k">else</span> <span class="mi">100</span><span class="p">,</span>
                <span class="s1">&#39;withhistory&#39;</span><span class="p">:</span> <span class="n">withhistory</span><span class="p">,</span>
                <span class="s1">&#39;fullres&#39;</span><span class="p">:</span> <span class="n">fullres</span><span class="p">,</span>
                <span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">post_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span><span class="p">,</span> <span class="s1">&#39;reverse_train&#39;</span><span class="p">,</span> 
                            <span class="n">data</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">newinputs</span><span class="p">,</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">ender</span><span class="p">,</span> <span class="n">history</span> <span class="o">=</span> <span class="n">res</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">newinputs</span><span class="p">,</span> <span class="n">ender</span> <span class="o">=</span> <span class="n">res</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">newinputs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fullres</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">newinputs</span><span class="p">,</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">ender</span><span class="p">,</span> <span class="n">history</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span><span class="c1">#, newinputs</span></div>
   
<div class="viewcode-block" id="Model.inputIndexFromName"><a class="viewcode-back" href="../../model.html#model.model.Model.inputIndexFromName">[docs]</a>    <span class="k">def</span> <span class="nf">inputIndexFromName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targetName</span><span class="p">,</span> <span class="n">inNames</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the index of a given target input name.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        </span>
<span class="sd">        - targetName -&gt; input name to retrieve.</span>
<span class="sd">        - inNames -&gt; set of names to check. If None, model input names are used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">inNames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputNames</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">inNames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">targetName</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span></div>
    
<div class="viewcode-block" id="Model.inputNames"><a class="viewcode-back" href="../../model.html#model.model.Model.inputNames">[docs]</a>    <span class="k">def</span> <span class="nf">inputNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrive the list of input names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span><span class="p">,</span> <span class="s1">&#39;inputNames&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Model.outputNames"><a class="viewcode-back" href="../../model.html#model.model.Model.outputNames">[docs]</a>    <span class="k">def</span> <span class="nf">outputNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the output names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span><span class="p">,</span> <span class="s1">&#39;outputNames&#39;</span><span class="p">)</span> </div>
    
<div class="viewcode-block" id="Model.inputs"><a class="viewcode-back" href="../../model.html#model.model.Model.inputs">[docs]</a>    <span class="k">def</span> <span class="nf">inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intype</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span> <span class="c1"># intype = 0: registedred inputs, 1: mean inputs, 2: inputs interval</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the input informations.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        </span>
<span class="sd">        - intype -&gt; returned information type:</span>
<span class="sd">            - 0 -&gt; return input values</span>
<span class="sd">            - 1 -&gt; return mean input value inside the allowed input interval.</span>
<span class="sd">            - 2 -&gt; return the allowed input interval</span>

<span class="sd">        - index -&gt; if &lt; 0, return input info vector. Else return the indexed input info</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">intype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;attributes&#39;</span><span class="p">:</span> <span class="s1">&#39;inputRanges&#39;</span><span class="p">}</span>
            <span class="n">dicores</span> <span class="o">=</span> <span class="n">get_model_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">dicores</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;inputRanges&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">float</span><span class="p">(</span><span class="n">mini</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">maxi</span><span class="p">))</span> <span class="k">for</span> <span class="n">mini</span><span class="p">,</span> <span class="n">maxi</span> <span class="ow">in</span> <span class="n">res</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>    
            <span class="k">return</span> <span class="n">res</span>    
        <span class="k">if</span> <span class="n">intype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;attributes&#39;</span><span class="p">:</span> <span class="s1">&#39;meanInputs&#39;</span><span class="p">}</span>
            <span class="n">dicores</span> <span class="o">=</span> <span class="n">get_model_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">dicores</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;meanInputs&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">res</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>    
            <span class="k">return</span> <span class="n">res</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">get_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span><span class="p">,</span> <span class="s1">&#39;inputs&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">):</span> 
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">res</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">float</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span> <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">val</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">res</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>    
        <span class="k">return</span> <span class="n">res</span></div>
    
<div class="viewcode-block" id="Model.outputs"><a class="viewcode-back" href="../../model.html#model.model.Model.outputs">[docs]</a>    <span class="k">def</span> <span class="nf">outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outtype</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span> <span class="c1"># outtype = 0: registedred outputs, 1: mean inputs, 2: outputs interval</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the outputs informations.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        </span>
<span class="sd">        - outtype -&gt; returned information type:</span>
<span class="sd">            - 0 -&gt; return output values</span>
<span class="sd">            - 1 -&gt; return mean output value inside the allowed output interval.</span>
<span class="sd">            - 2 -&gt; return the allowed output interval</span>

<span class="sd">        - index -&gt; if &lt; 0, return output info vector. Else return the indexed output info</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">outtype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;attributes&#39;</span><span class="p">:</span> <span class="s1">&#39;outputRanges&#39;</span><span class="p">}</span>
            <span class="n">dicores</span> <span class="o">=</span> <span class="n">get_model_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">dicores</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;outputRanges&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="c1">#for (min, max) in res:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">float</span><span class="p">(</span><span class="n">mini</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">maxi</span><span class="p">))</span> <span class="k">for</span> <span class="n">mini</span><span class="p">,</span> <span class="n">maxi</span> <span class="ow">in</span> <span class="n">res</span><span class="p">]</span>    
            <span class="k">return</span> <span class="n">res</span>    
        <span class="k">if</span> <span class="n">outtype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;attributes&#39;</span><span class="p">:</span> <span class="s1">&#39;meanOutputs&#39;</span><span class="p">}</span>
            <span class="n">dicores</span> <span class="o">=</span> <span class="n">get_model_attribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">dicores</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;meanOutputs&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">res</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">res</span>
        <span class="k">return</span> <span class="n">get_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span><span class="p">,</span> <span class="s1">&#39;outputs&#39;</span><span class="p">)</span></div>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">inputNorm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the input normalization values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span><span class="p">,</span> <span class="s1">&#39;inputNorm&#39;</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">outputNorm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the output normalization values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span><span class="p">,</span> <span class="s1">&#39;outputNorm&#39;</span><span class="p">)</span>
    
<div class="viewcode-block" id="Model.targets"><a class="viewcode-back" href="../../model.html#model.model.Model.targets">[docs]</a>    <span class="k">def</span> <span class="nf">targets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the training target values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">get_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span><span class="p">,</span> <span class="s1">&#39;targets&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">propertyName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputNames</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">modelName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modelname</span>
    <span class="nd">@modelName</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">modelName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_modelname</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">model_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">owner_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_description</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">weights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;prefix&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">get_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span><span class="p">,</span> <span class="s1">&#39;getWeights&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="nd">@weights</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;weights&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
                <span class="s1">&#39;prefix&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="n">post_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_owner_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_id</span><span class="p">,</span> <span class="s1">&#39;setWeights&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span></div>

<span class="c1">#==============================================================================#</span>
<span class="k">def</span> <span class="nf">_connectTest</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;jeanluc&#39;</span><span class="p">):</span>
    
    <span class="n">userjl</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">userjl</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">userjl</span>

<span class="k">def</span> <span class="nf">_runNMLTest</span><span class="p">(</span><span class="n">userjl</span><span class="p">):</span>
    <span class="n">modelNML_0</span> <span class="o">=</span> <span class="s2">&quot;/Users/jeanluc/Documents/LiClipseWorkspace/Metaphor_api/src&quot;</span><span class="o">+</span>\
    <span class="s2">&quot;/testfiles/Tests SAP Samir MEDROUK/Modeles fusionnes/Modele_Final_V2.NML&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">modelNML_0</span><span class="p">,</span>
            <span class="s1">&#39;docompile&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="c1">#            &#39;modelname&#39;: &quot;TestModel&quot;</span>
        <span class="p">}</span>
    <span class="n">mymodel</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">userjl</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> 
    <span class="n">inpts</span> <span class="o">=</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">inputs</span><span class="p">()</span>
    <span class="n">inptnas</span> <span class="o">=</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">inputNames</span><span class="p">()</span>
    <span class="n">intervals</span> <span class="o">=</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">inputs</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">nm</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">inpts</span><span class="p">,</span> <span class="n">inptnas</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">nm</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mymodel :&#39;</span><span class="p">)</span>
<span class="c1">#    print(&#39;\tproperty -&gt; {0}&#39;.format(mymodel.propertyName))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">owner_id -&gt; </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mymodel</span><span class="o">.</span><span class="n">owner_id</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">model_id -&gt; </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mymodel</span><span class="o">.</span><span class="n">model_id</span><span class="p">))</span>
<span class="c1">#    print(&quot;\tmodelname -&gt; {0}&quot;.format(mymodel.modelName))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">description -&gt; </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mymodel</span><span class="o">.</span><span class="n">description</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;inputs:&quot;</span><span class="p">,</span> <span class="n">inpts</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">inpts</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;output:&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    
    <span class="n">result</span> <span class="o">=</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">inputs</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;input ranges:&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>

    <span class="n">means</span> <span class="o">=</span> <span class="p">[(</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mean inputs:&quot;</span><span class="p">,</span> <span class="n">means</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">means</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;output with mean inputs:&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    
    <span class="n">outInterval</span> <span class="o">=</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">outputs</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;output range&quot;</span><span class="p">,</span> <span class="n">outInterval</span><span class="p">)</span>
    
<span class="c1">#     freeinputs = [0 for _ in range(len(inpts))]</span>
<span class="c1">#     freeinputs[9] = 1</span>
<span class="c1">#     freeinputs[10] = 1</span>
    <span class="n">freeinputs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
    <span class="n">target</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.02</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">means</span>
    
    <span class="n">newresult</span><span class="p">,</span> <span class="n">newinputs</span><span class="p">,</span> <span class="o">*</span><span class="n">wds</span> <span class="o">=</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">reverse_train</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">freeinputs</span><span class="p">,</span> 
            <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fullres</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">oldinputs</span> <span class="o">=</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">inputs</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">,</span> <span class="n">newresult</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;new inputs&quot;</span><span class="p">,</span> <span class="n">newinputs</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">_runNMLcurve</span><span class="p">(</span><span class="n">userjl</span><span class="p">):</span> 
    <span class="kn">import</span> <span class="nn">os</span>   
    <span class="n">modelNML_0</span> <span class="o">=</span> <span class="s2">&quot;/Users/jeanluc/Documents/LiClipseWorkspace/Metaphor_api/src&quot;</span><span class="o">+</span>\
    <span class="s2">&quot;/testfiles/Tests SAP Samir MEDROUK/Modeles fusionnes/Modele_Final_V2.NML&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">modelNML_0</span><span class="p">,</span>
            <span class="s1">&#39;docompile&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="c1">#            &#39;modelname&#39;: &quot;TestModel&quot;</span>
        <span class="p">}</span>
    <span class="n">mymodel</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">userjl</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> 
    <span class="n">inpts</span> <span class="o">=</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">inputs</span><span class="p">()</span>
    <span class="n">inptnas</span> <span class="o">=</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">inputNames</span><span class="p">()</span>
    <span class="n">intervals</span> <span class="o">=</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">inputs</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">inranges</span> <span class="o">=</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">inputs</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="c1">#     print(&quot;input ranges:&quot;, result)</span>

    <span class="n">means</span> <span class="o">=</span> <span class="p">[(</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">inranges</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mean inputs:&quot;</span><span class="p">,</span> <span class="n">means</span><span class="p">)</span>
 <span class="c1">#   names = mymodel.inputNames()</span>
    <span class="n">do_plot</span><span class="p">(</span><span class="n">mymodel</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">inptnas</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="s1">&#39;toto&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">do_plot</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">inputname</span><span class="p">,</span> <span class="n">outputname</span><span class="p">):</span> 
    <span class="n">inputindex</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">inputNames</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">inputname</span><span class="p">)</span>
    <span class="n">mini</span><span class="p">,</span> <span class="n">maxi</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">inputs</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">inputindex</span><span class="p">)</span>
    <span class="n">Xlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mini</span><span class="p">,</span> <span class="n">maxi</span><span class="p">,</span> <span class="mi">201</span><span class="p">)</span> 
    <span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">inputindex</span><span class="p">,</span> <span class="n">indexlist</span><span class="o">=</span><span class="n">Xlist</span><span class="p">)</span>
    <span class="c1">#plt.plot(Xlist, result)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">inputname</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
   

<span class="k">def</span> <span class="nf">_runCreateTest</span><span class="p">(</span><span class="n">userjl</span><span class="p">):</span>
    <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;/Users/jeanluc/Documents/LiClipseWorkspace/Metaphor_api/src/testfiles/L_153.csv&quot;</span>
    <span class="n">modeldata</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;datasource&#39;</span><span class="p">:</span> <span class="n">source</span><span class="p">,</span>
<span class="c1">#        &#39;modelname&#39;: &#39;myTrainableModel&#39;,</span>
        <span class="s1">&#39;inputs&#39;</span><span class="p">:</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span>
        <span class="s1">&#39;hidden&#39;</span><span class="p">:</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span>
        <span class="s1">&#39;trainable&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;forcecreate&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">testmodel</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">userjl</span><span class="p">,</span> <span class="n">modeldata</span><span class="o">=</span><span class="n">modeldata</span><span class="p">)</span> 
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;modelName:&quot;</span><span class="p">,</span> <span class="n">testmodel</span><span class="o">.</span><span class="n">modelName</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;description:&quot;</span><span class="p">,</span> <span class="n">testmodel</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_runCreateTraining</span><span class="p">(</span><span class="n">userjl</span><span class="p">):</span>
<span class="c1">#     delete_models(userjl.user_id, data={&#39;delete&#39;: &quot;*&quot;})</span>
    
<span class="c1">#     WW22 = np.zeros((22,))</span>
    <span class="n">WW22</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">22</span><span class="p">)]</span>
    <span class="n">WW22</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.039843524921</span>
    <span class="n">WW22</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.11974612107</span>
    <span class="n">WW22</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.048612387027</span>
    <span class="n">WW22</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.19084323523</span>
    <span class="n">WW22</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.084070986799</span>
    <span class="n">WW22</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.03008236605</span>
    <span class="n">WW22</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.069560996908</span>
    <span class="n">WW22</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.11159221823</span>
    <span class="n">WW22</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.047867121706</span>
    <span class="n">WW22</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.10994423754</span>
    <span class="n">WW22</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.094399533507</span>
    <span class="n">WW22</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.021777191667</span>
    <span class="n">WW22</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.080970843388</span>
    <span class="n">WW22</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0061677630808</span>
    <span class="n">WW22</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.067246044709</span>
    <span class="n">WW22</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0019394849107</span>
    <span class="n">WW22</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="mf">7.11023083E-05</span>
    <span class="n">WW22</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0015981840668</span>
    <span class="n">WW22</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.1199492128</span>
    <span class="n">WW22</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.097958760835</span>
    <span class="n">WW22</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.027484232802</span>
    <span class="n">WW22</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.16873545622</span>
    
<span class="c1">#     filename0 = &quot;/Users/jeanluc/Documents/LiClipseWorkspace/Metaphor_Test/src/metaphor/test_monal/testFiles/fullalea.csv&quot;</span>
    <span class="n">filename1</span> <span class="o">=</span> <span class="s2">&quot;/Users/jeanluc/Documents/LiClipseWorkspace/Metaphor_Test/src/metaphor/test_monal/testFiles/L_153.csv&quot;</span>
    <span class="n">filename2</span> <span class="o">=</span> <span class="s2">&quot;/Users/jeanluc/Documents/LiClipseWorkspace/Metaphor_Test/src/metaphor/test_monal/testFiles/l_153.xlsx&quot;</span>
    <span class="n">filename3</span> <span class="o">=</span> <span class="s2">&quot;/Users/jeanluc/Documents/LiClipseWorkspace/Metaphor_Test/src/metaphor/test_monal/testFiles/l_153.xls&quot;</span>

<span class="c1">#     range</span>
<span class="c1">#     headers</span>
<span class="c1">#     datasource = filename1</span>
    <span class="n">arange</span> <span class="o">=</span> <span class="s1">&#39;DATA&#39;</span>
    <span class="n">hidden</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">dataformat</span> <span class="o">=</span> <span class="s2">&quot;0,1,2,3,4;5&quot;</span>
    <span class="n">forcecreate</span> <span class="o">=</span> <span class="kc">True</span>
    
<span class="c1">#     model1 = Model.createFromData(userjl, datasource=filename1, </span>
<span class="c1">#         hidden=hidden, dataformat=dataformat, arange=arange, </span>
<span class="c1">#         forcecreate=forcecreate)</span>
<span class="c1">#     print(&quot;model_id&quot;, model1.model_id)</span>
<span class="c1">#     print(&#39;inputNames&#39;, model1.inputNames())</span>
<span class="c1">#     print(&#39;outputNames&#39;, model1.outputNames())</span>
<span class="c1">#     print(&#39;targets&#39;, model1.targets())</span>
<span class="c1">#     </span>
<span class="c1">#     model2 = Model.createFromData(userjl, datasource=filename2, </span>
<span class="c1">#         hidden=hidden, dataformat=dataformat, arange=arange, </span>
<span class="c1">#         forcecreate=forcecreate)</span>
<span class="c1">#     print(&quot;model_id&quot;, model2.model_id)</span>
<span class="c1">#     print(&#39;inputNames&#39;, model2.inputNames())</span>
<span class="c1">#     print(&#39;outputNames&#39;, model2.outputNames())</span>
<span class="c1">#     print(&#39;targets&#39;, model2.targets())</span>
    
    <span class="n">model3</span> <span class="o">=</span> <span class="n">Model</span><span class="o">.</span><span class="n">createFromData</span><span class="p">(</span><span class="n">userjl</span><span class="p">,</span> <span class="n">datasource</span><span class="o">=</span><span class="n">filename3</span><span class="p">,</span> 
        <span class="n">hidden</span><span class="o">=</span><span class="n">hidden</span><span class="p">,</span> <span class="n">dataformat</span><span class="o">=</span><span class="n">dataformat</span><span class="p">,</span> <span class="n">arange</span><span class="o">=</span><span class="n">arange</span><span class="p">,</span> 
        <span class="n">forcecreate</span><span class="o">=</span><span class="n">forcecreate</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;model_id&quot;</span><span class="p">,</span> <span class="n">model3</span><span class="o">.</span><span class="n">model_id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;inputNames&#39;</span><span class="p">,</span> <span class="n">model3</span><span class="o">.</span><span class="n">inputNames</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;outputNames&#39;</span><span class="p">,</span> <span class="n">model3</span><span class="o">.</span><span class="n">outputNames</span><span class="p">())</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="n">model3</span><span class="o">.</span><span class="n">targets</span><span class="p">()</span>
<span class="c1">#    print(&#39;targets&#39;, model3.targets())</span>
    <span class="n">traindata</span> <span class="o">=</span> <span class="n">model3</span><span class="o">.</span><span class="n">trainigData</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;inputdata[0]&#39;</span><span class="p">,</span> <span class="n">traindata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;inputdata[-1]&#39;</span><span class="p">,</span> <span class="n">traindata</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dim&#39;</span><span class="p">,</span> <span class="n">model3</span><span class="o">.</span><span class="n">paramCount</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">model3</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
    <span class="n">nw</span> <span class="o">=</span> <span class="n">model3</span><span class="o">.</span><span class="n">newWeights</span><span class="p">(</span><span class="n">doset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">#    model3.weights = WW22</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">model3</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;inputNorm&#39;</span><span class="p">,</span> <span class="n">model3</span><span class="o">.</span><span class="n">inputNorm</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;outputNorm&#39;</span><span class="p">,</span> <span class="n">model3</span><span class="o">.</span><span class="n">outputNorm</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">()</span>
<span class="c1">#    print(&quot;inputs(0)&quot;, model3.inputs(index = 0))</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">model3</span><span class="o">.</span><span class="n">transfer</span><span class="p">([</span><span class="mf">28.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">,</span> <span class="mf">79.0</span><span class="p">,</span> <span class="mf">17.0</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;transfer </span><span class="se">\t</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="n">nn</span> <span class="o">=</span> <span class="n">model3</span><span class="o">.</span><span class="n">dataCount</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;before training&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">tg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">targets</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">model3</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">ind</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;transfer </span><span class="si">{0}</span><span class="s1">:</span><span class="se">\t</span><span class="si">{1}</span><span class="s1">  </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">tg</span><span class="p">,</span> <span class="n">res</span><span class="p">))</span>
    
    <span class="n">newweights</span> <span class="o">=</span> <span class="n">model3</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">epochs</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="s1">&#39;debug&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;after training&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">tg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">targets</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">model3</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">ind</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;transfer </span><span class="si">{0}</span><span class="s1">:</span><span class="se">\t</span><span class="si">{1}</span><span class="s1">  </span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">tg</span><span class="p">,</span> <span class="n">res</span><span class="p">))</span>
        
    
    <span class="nb">print</span><span class="p">(</span><span class="n">newweights</span><span class="p">)</span>
    
<span class="c1">#     del model1</span>
<span class="c1">#     del model2</span>
    <span class="k">del</span> <span class="n">model3</span>
    

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    
    <span class="n">server</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span>
    <span class="n">port</span> <span class="o">=</span> <span class="mi">5005</span>
    <span class="n">APIVer</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span>
    
    <span class="n">result</span> <span class="o">=</span> <span class="n">initiate_connection</span><span class="p">(</span><span class="n">server</span><span class="o">=</span><span class="n">server</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="n">userjl</span> <span class="o">=</span> <span class="n">_connectTest</span><span class="p">()</span>
    <span class="n">_runNMLcurve</span><span class="p">(</span><span class="n">userjl</span><span class="p">)</span>
<span class="c1">#    _runNMLTest(userjl)</span>
<span class="c1">#    _runCreateTest(userjl)</span>
<span class="c1">#    _runCreateTraining(userjl)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done&quot;</span><span class="p">)</span>
    
        
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../metaphor_client.html">metaphor_client 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Jean Luc PLOIX.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.1.
    </div>
  </body>
</html>